<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Hexo</title>
  














<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/2019-10-22-%E9%83%AD%E6%95%AC%E6%98%8E%E7%9A%84%E4%B8%8A%E7%BA%B2%E4%B8%8A%E7%BA%BF%E5%92%8C%E6%9D%8E%E8%AF%9A%E5%84%92%E7%9A%84%E5%80%9A%E8%80%81%E5%8D%96%E8%80%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/22/2019-10-22-%E9%83%AD%E6%95%AC%E6%98%8E%E7%9A%84%E4%B8%8A%E7%BA%B2%E4%B8%8A%E7%BA%BF%E5%92%8C%E6%9D%8E%E8%AF%9A%E5%84%92%E7%9A%84%E5%80%9A%E8%80%81%E5%8D%96%E8%80%81/" itemprop="url">郭敬明的上纲上线和李诚儒的倚老卖老</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T00:00:00+08:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>郭敬明，这个永远跟“抄袭”挂钩的名字，也是倔强和励志的标志性人物。他本人恐怕也不在意外界是否当他是一名作家，他在图书运作上的成就无法否认，如今转行电影，也为自己争到了一把能跟陈凯歌和李少红平起平坐的位置——至少在娱乐节目上是这样的。当然不必太较真，一档综艺节目的考量总是复杂的，郭敬明的话题性比什么都重要。这种搭配是一种要权威性又要眼球的综合结果。</p>
<p>就是这么一档娱乐节目，叫什么我没兴趣，但这个流传开来的片段引起了争议，值得聊一聊。可以先看下这个片段。</p>
<p>简单说郭敬明作为导师的一群年轻人表演了一些片段，校园里的情情爱爱，李诚儒老师作为特邀评委满脸疑惑，坐不住了，“如坐针毡，如芒刺背“，这个不用李诚儒老师亲口说，他脸上写满了厌恶和不屑。</p>
<p>李诚儒的反应一点也不特别，哪怕再年轻个二十岁我也看不进那些破烂玩意，青春戏是一种类型，会永远存在，但不能说这个类型有问题，不管是故事还是表演，必然有好坏之分。李诚儒作为特邀嘉宾，从专业的角度，只点评表演，怎么说都是尽职尽责的表现，批评的话总是难听，虽然可以更温和更含蓄一些。然而问题就出在后面，很快李诚儒老师表达了对影视内容的一种期待，尤其是思想教育方面的期待。</p>
<p>李诚儒老师说难道我们现在的年轻人只看这种高中生谈恋爱，男生女生抱在一起就起哄。家国情怀，忠人义士，值得书写的太多了。诚儒老师语重心长，这样下去，这一辈年轻人能受到什么样的教育呢。</p>
<p>这一幕无法不让人想起十几年前的一场“反三俗”座谈会。一帮德高望重的人民艺术家批评当下的流行文化的媚俗、庸俗、低俗。姜昆老师差不多也是因为这个“反三俗”的高调表现，被半永久地钉在文化的耻辱柱上，供人们在回顾历史时感慨。</p>
<p>李诚儒老师的语气和预期我们都相当熟悉，仿佛老师和家长附体，对偷摸看有害读物进行的严厉批评。用一直以来都比较流行的话，老了之后变成自己年轻时最讨厌的那种人。虽然时代在变，但年轻人的某些特质不会变，叛逆，赶时髦，无病呻吟，冲动，李老师可能忘了自己年轻的时候是什么操行。正好，李诚儒老师也说了，这不畅销书吗。就差直接劈头盖脸质问郭敬明为何那么善于制造垃圾。</p>
<p>郭敬明的成功也恰恰说明了他特别懂年轻人的真实需求。不管是刻意为之还是凑巧水平刚好匹配。所以即便我们认为那些东西都是垃圾，但也很难知道郭敬明是故意制造垃圾，还是刚好只会生产垃圾。这是很难判断的。</p>
<p>纯审美的角度，我大概和李诚儒老师差不多，若在现场脸色不一定会比他好看。但我一点也不担心这一辈年轻人会因为这种“破剧”而带来教育上的坏影响。我十分理解年轻人就喜欢看这些，集齐最优秀团队做出来的审美上高级的青春电影，也无法离开情情爱爱。放眼整个流行音乐，无论水平如何，大体上也都是情情爱爱。</p>
<p>李诚儒老师的讨厌就在于我们常见的倚老卖老，并且喜欢把一切内容都上升到教育层面。题外话，李诚儒老师最广为人知的表演是在《大腕》里最后一幕扮演的精神病患者的独白，不知道李老师如何去定义这部电影的教育意义，年轻人看了《大腕》在精神层面上能得到什么层次的升华？我想这部电影大概也就是图个乐。</p>
<p>郭敬明的回应却赢得了喝彩。然而郭敬明的回应我更厌恶。</p>
<p>如果说李诚儒老师只是挺讨厌的，郭敬明的回应则有点上纲上线了。郭敬明多么聪明啊，先把责任都揽自己身上，显得非常得体，其实本来就是他指导的作品。然乎指出自己的作品并非只有情情爱爱，而是勇敢披露了校园霸凌现象，最高明的当然是最后引用的这句话：你可以永远不喜欢你不喜欢的东西，但请允许它存在；你可以继续讨厌自己讨厌的东西，但请允许别人对它的喜欢。</p>
<p>多么正的价值观啊，值得所有人捍卫。问题是，这话你跟李诚儒老师说得着吗？李诚儒只是一个演员，哪里有任何能力“不允许”他不喜欢东西的存在了。大家心知肚明，只有权力才可以。然而你试想下在那样一个现场，郭敬明说出“如此绝对正确”的话来，等于是说李诚儒成了一个坏人。这是一种极其可恶的诡辩术。</p>
<p>如果有一天郭敬明的电影被有关部门封杀，这时郭敬明祭出这句掷地有声的话，才是完全用对了场合，我们也应该支持自己不喜欢的东西存在，否则有一天你喜欢的东西也会无缘无故被消失。</p>
<p>就郭敬明把一种喜好偷换成权利之后，悄无声息地给李诚儒老师扣上了恶人的帽子，与此同时倒是把自己给打扮得相当宽容和正义，可以心安理得地继续生产垃圾（对不住了，郭敬明的东西确实是垃圾，但支持喜欢的人开心就好），毕竟郭敬明的意思是，你不喜欢是你的事，有人喜欢就行了。这就完全离题了，虽然李诚儒作为评委率先跑偏了。</p>
<p>平日里一些文盲都也喜欢用“上纲上线”这个词，但经常乱用。郭敬明在那样一个语境里说这句口号就叫“上纲上线”。这话很对，但用错场景了，比较恶劣。我经常也遇到过，在谈论我不喜欢的东西，有读者就很着急说，人家有存在的权利。极其令人胸闷，我哪有能力和资格不允许那些丑恶的东西存在了呢，每个人都有自己的喜好，表达喜好还得解释一下？有时我也在想，这些理解不了喜好和权利的和整天跟随官方各种限制声音后面喊打喊杀的到底是不是同一批人？</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/22/2019-10-22-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%9A%84String/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/22/2019-10-22-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%9A%84String/" itemprop="url">深入理解Java的String</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T00:00:00+08:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如果要想理解String，那么就需要先理解JVM虚拟机以及String在JVM层的解析.</p>
<h1 id="JVM相关"><a href="#JVM相关" class="headerlink" title="JVM相关"></a>JVM相关</h1><ul>
<li>Java栈：这个是用来存放栈帧的,每个方法被执行的时候就会同时创建一个栈帧用于存储局部变量表，操作栈,动态连接等</li>
<li>Java堆：在虚拟机启动创建时，这里的唯一目的就是存放对象的实例,几乎所有的对象实例都在这里创建分配</li>
<li>方法区：存放每个类的结构信息。</li>
<li>常量池：静态常量池存在于Class文件中,运行时常量池存放一些运行时常量数据.</li>
</ul>
<h1 id="字符串常量池"><a href="#字符串常量池" class="headerlink" title="字符串常量池"></a>字符串常量池</h1><p>字符串常量池是存在于运行时常量池中(JDK7之前存在运行时常量池中,JDK7之后转移到了堆中)<br><strong>使用字符串常量池时,每当我们使用字面量(String s = “abc”)创建字符串JVM会首先检查在字符串常量池中是否已经存在”abc”如果存在就将字符串对象的地址赋值给引用s,如果不存在字符串常量池中就会实例化该字符串并将”abc”放入常量池中,并将此字符串对象的地址赋值给引用s</strong></p>
<p><strong>当我们使用关键字new(String s = new String(“abc”))创建字符串时如果“abc”不在字符串常量池中我们就会实例化给字符串并将其放入常量池中,然后在堆中复制一个副本，然后将堆中的对象的地址赋值给s;如果给字符串存在字符串常量中那么就不在再字符串常量池创建”abc”，而是在堆中直接复制一个副本然后将堆中对象的地址赋值给s</strong></p>
<h1 id="String在JVM层解析"><a href="#String在JVM层解析" class="headerlink" title="String在JVM层解析"></a>String在JVM层解析</h1><h3 id="创建字符串的两种形式"><a href="#创建字符串的两种形式" class="headerlink" title="创建字符串的两种形式:"></a>创建字符串的两种形式:</h3><ol>
<li>String s1 = “abc”;</li>
<li>String s2 = new String(“abc”);</li>
</ol>
<p><img src="/img/in-post/20180827123540873.png" alt=""></p>
<p>s1使用字面量创建字符串在编译期的时候判断“abc”是否存在于字符串常量池中如果存在就直接返回对象的引用。<br>s2使用关键字new创建字符串，如果“abc”存在于字符串常量池中我们就在堆中创建一个副本然后将堆中的地址赋值给s2，否则就在字符串常量池中创建“abc”然后在堆中创建副本再将堆中的地址赋值给s2.<br><strong>他们之间的区别就是一个直接将字符串常量池中的引用给s，一个是将堆中的引用赋值给new出来的s2</strong></p>
<h3 id="“-”连接形式创建的字符串"><a href="#“-”连接形式创建的字符串" class="headerlink" title="“+”连接形式创建的字符串"></a>“+”连接形式创建的字符串</h3><ul>
<li>String s = “a”+”b”+”c”</li>
</ul>
<p><img src="/img/in-post/20180827123632152.png" alt=""></p>
<p>这种全是常量的字符串会再编译期间直接录入字符串常量池中，同时还需要判断“abc”是否存在字符串常量池中。</p>
<ul>
<li>String s2 = “1”+”3”+new String(“1”)+”4”</li>
</ul>
<p><img src="/img/in-post/20180827123647339.png" alt=""></p>
<p>因为+号连接符中有new关键字所有我们无法在编译期间无法知道s2的值，因此先处理“1”+“3”的字符串首先拼接然后将其放入字符串常量池中形成“13”，然后接着在字符串常量池中创建“1”然后将“1”的引用指定给堆中的一个String对象，最后在字符串常量池中创建一个“4”。<br>接下来创建new StringBuilder拼接，最后形成一个新的String然后将它的引用指定给s2。<br>String s2=new StringBuilder(“13”).append(new String(“1”)).append(“4”).toString();</p>
<ul>
<li>String s3=new String(“abc”)+new String(“def”);</li>
</ul>
<p><img src="/img/in-post/20180827123737708.png" alt=""></p>
<p>在程序运行期间首先检查字符串常量池中是否有“abc”如果没有就创建一个然后在堆中创建一个String对象指向“abc”，然后再创建“def”也是先检查是否存在，接下来就堆中创建一个String指向”def”，最终我们通过Stringbuilder在堆中将他们拼接起来形成一个新的String然后将这个String的引用指定给s3。</p>
<blockquote>
<p>参考资料： <a href="https://blog.csdn.net/qq_34490018/article/details/82110578" target="_blank" rel="noopener">https://blog.csdn.net/qq_34490018/article/details/82110578</a> </p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/18/2019-10-18-%E4%BD%A0%E5%AF%B9%E5%91%A8%E6%9D%B0%E4%BC%A6%E4%BB%80%E4%B9%88%E8%AF%84%E4%BB%B7%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/18/2019-10-18-%E4%BD%A0%E5%AF%B9%E5%91%A8%E6%9D%B0%E4%BC%A6%E4%BB%80%E4%B9%88%E8%AF%84%E4%BB%B7%EF%BC%9F/" itemprop="url">你对周杰伦什么评价？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-18T00:00:00+08:00">
                2019-10-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>罗大佑和周杰伦到底谁更牛逼？</p>
<p>你为什么会「觉得他以前的《以父之名》《龙拳》《稻香》都是经典」？</p>
<p>关于这两个问题有一个你可能意想不到的角度——一个理论可以完美回答你这两个问题！详情请看下面的文章《永远的十四岁》。</p>
<p>周杰伦是上等人还是下等人？</p>
<p>你知道吗，我这几年在微博上陆陆续续嘲笑过的种种「下等人」的行为，比如我说：管马桶叫「坐便器」的都是下等人，或者：「名表」在很多时候的确是一种身份标志——下等人的身份标志，看起来好像很随机没什么联系，但是很大一部分都可以归结为同一种行为：</p>
<p>装逼。</p>
<p>概括地说：</p>
<p>爱「装」的人都是下等人。没错，人分上等人跟下等人。</p>
<p>至于周杰伦到底是上等人还是下等人，说实话我不是很确定，不过下面一篇相关的文章《周杰伦是外宾还是内宾？》说不定可以给你提供一个小参考数据，你看了自己判断吧。</p>
<p>如何「总体上」评价周杰伦？</p>
<p>最后是一篇旧文《如何评价周杰伦？》，那篇文章是我两年多前写的，不管是文中讲的套路还是最后的结论，放在现在好像也很适用。</p>
<p>我就不剧透了，你自己看吧。</p>
<p>全文 5100 字。
　　</p>
<p>永远的十四岁<br>一​</p>
<p>大概是去年五月吧，我去上海梅赛德斯中心听了一场罗大佑老师的演唱会，演唱会的题目是《当年离家的年轻人》。</p>
<p>说真的我对这场演唱会还是相当地期待的——罗大佑老师是我多年的​音乐偶像。</p>
<p>大学的时候谈恋爱，我应该是逼着每一个跟我约会的女生都听过罗大佑，还会没完没了地给人家讲解罗大佑音乐、歌词里的深意、精妙、种种另我感动不已的细节。</p>
<p>有不少这样的「感悟」讲得次数多了成了固定的、精彩的段子，被我当成了泡妞的套路，后来又重复过很多次，但好像每次还是能把我自己感动了。哈哈有几个我到现在还记得，前两年在分答上回答问题还搬出来使用过。</p>
<p>当年原版磁带、 CD 国内不好卖，美籍同学苏立去台湾玩儿，问我有什么要带的东西，我特意让她带了一张罗大佑八四年演唱会的实况《青春舞曲》。一个小细节，那时候台湾的每一张收据上都印着这么一句话：防匪防谍，人人有责。</p>
<p>怎么样，有时代感吧？</p>
<p>后来出国上学、工作，随着年龄越来越大，罗大佑听得少了。经常是把那张《青春舞曲》都拿起来了，结果又放下，换了一张其他的唱片。</p>
<p>你发现没有，音乐有一种神奇的功能，会一下子把你带回以前的某一个时刻、某一种无比真实的情绪中去。等你像我这把年纪了可能会理解，去听年轻时候热爱的音乐有时候需要点儿勇气。</p>
<p>不是不再喜欢，而是不想在忙了一天很累的时候被一下子弄得瞎动感情。</p>
<p>二</p>
<p>好吧不瞎感慨了，用数据说话。</p>
<p>哈佛大学经济学博士谷歌前数据科学家畅销书《Everybody Lies》作者 Seth Stephens-Davidowitz 做过这么一个研究。</p>
<p>他统计、研究了 Spotify（类似于QQ音乐）上某一首歌播放次数和听者年龄的关系，统计包括了从一九六〇年到二〇〇〇年所有Billboard榜单冠军歌曲。惊人的发现是，从统计上看，每个人最喜欢的歌几乎都是他们十四岁那年发行的！</p>
<p>Source: analysis of Spotify data by Seth Stephens-DavidowitzSource: analysis of Spotify data by Seth Stephens-Davidowitz</p>
<p>Source: analysis of Spotify data by Seth Stephens-Davidowitz</p>
<p>​​反思了一下，在我身上这个结果相当准确。罗大佑老师的《青春舞曲》专辑是他一九八四年演唱会实况，那一年你猜我几岁？</p>
<p>十四！</p>
<p>我操太准了。</p>
<p>当然，研究显示男生、女生稍有差别——男生最喜欢十四岁那年发行的歌曲，而女生稍早，十三岁是高峰。再仔细看看上面这张图，如果你是一个男生，你二十四岁那年发行的歌对于你音乐偏好的影响还不到十四岁那年的一半！</p>
<p>好吧，咱们拿这个结果套一套周杰伦。</p>
<p>周杰伦大红大紫的差不多是二〇〇三年，这一年他上了《时代》杂志亚洲版封面，被誉为「新一代亚洲流行天王」，同年发布第四张专辑《叶惠美》。</p>
<p>按照上面的研究结果，周杰伦的「标准」粉丝在二〇〇三年差不多是十三、四岁。也就是说，他们应该生于一九九〇年左右，现在三十。</p>
<p>再看看蔡徐坤。</p>
<p>蔡徐坤大红大紫是二〇一八年初，单曲《I Wanna Get Love》上榜，《偶像练习生》夺冠。按照这个十四岁法则，蔡徐坤的核心粉丝群应该是二〇〇四年出生，今年十五。</p>
<p>周杰伦大红大紫的时候蔡徐坤的粉丝还没出生，这完全就是两代人啊！</p>
<p>三</p>
<p>当然，十四岁法则应用在这儿还没那么简单。</p>
<p>首先，十四岁法则说的是具体一首歌曲的爱好者的年龄分布，要延伸到一个「歌手」粉丝年龄的分布，情况要略复杂。</p>
<p>比如要考虑一个歌手「艺术生涯」的长度。</p>
<p>比如周杰伦吧，就是一个艺术生命相当长的人，上面我说他大红大紫是二〇〇三年是简化了，严格地说，从二〇〇一年第二张专辑《范特西》到二〇一〇年《跨时代》这十年里都算是个歌手。</p>
<p>所以，周杰伦的粉丝应该包括了从一九八七到一九九六年出生这十年的跨度，蔡徐坤刚红，就算他的粉丝再年轻再疯狂，毕竟红的时间有限，在数目上还是拼不过周杰伦。</p>
<p>所以一个推论是：艺术生命越长的歌手，粉丝越多。比如我一直不理解林俊杰好在哪儿了，但是你看看人家的艺术生命——人家拼的是时间——我操简直是老少通吃啊。</p>
<p>还有，十四岁法则涉及具体歌曲而不是歌星，所以，另一个推论就是，同样喜欢周杰伦的人，很肯能彼此并不认同。</p>
<p>比如你是因为喜欢《爱在西元前》、《安静》这些歌爱上周杰伦的，你可能会觉得他后来那些「中国风」很土鳖，《七里香》之后的专辑都没法听。反过来也一样，如果你是后来爱上周杰伦的，你会觉得他以前的歌老土。</p>
<p>同样，我觉得罗大佑后来写的什么《皇后大道东》、《恋曲一九九〇》之类简直没法听。而我认识的另一些罗大佑粉丝，反倒觉得这些才是经典。</p>
<p>十四岁法则的另一个缺陷是，有些音乐我很喜欢，比如 The Beatles 或者 Bob Dylan，可是明摆着这些音乐在我出生之前就已经流行了，至少是远在我十四岁之前，那怎么解释呢？</p>
<p>Seth Stephens-Davidowitz 也想到了这个问题，他的解释是他自己跟大众不同——发育反常。我倒觉得我没那么特殊，有一个更简单的解释：</p>
<p>有一类音乐会成为经典——夸代的经典，The Beatles, Bob Dylan, 崔健也许都属于这一类，你不需要跟这个音乐同时代而喜欢，而被影响。</p>
<p>当然这只是我的一个猜测。</p>
<p>崔健的经典专辑《新长征路上的摇滚》发行于八九年四月，当时老罗十五岁。</p>
<p>四</p>
<p>去年罗大佑的上海演唱会，我是带着一种近乎朝圣的心情去的。</p>
<p>当然，除了带了朝圣的心情，还带了两个九〇后美女。</p>
<p>结果很失望。</p>
<p>那天观众席里净是中年父母带着孩子，我旁边有一对夫妇和一个初中男生，那个初中男生从头到尾在手机上打游戏。他爸妈一开始还提醒他要好好看演唱会，后来干脆不管了，自己自顾自地跟着全场中年人群动情地唱「就在那多愁善感初次回忆的青春」去了。</p>
<p>台上的罗大佑，跟《青春舞曲》封面上那个长发墨镜的叛逆青年判若两人。</p>
<p>我多年保留的泡妞段子最后一个都没讲出口。</p>
<p>五</p>
<p>关于这件事，老罗说得极好：</p>
<p>借用托克维尔的句套子来说一下：中年人似乎热爱周杰伦，其实只是讨厌年轻人。
　　　</p>
<p>周杰伦是外宾还是内宾？<br>说两句他在西安演唱会上骂警察的事儿。</p>
<p>记得我头一回在中国看现场演唱会是好几年前有一次从纽约回北京，正好赶上「纵贯线」在工体首演。我进场一坐下，第一印象就是——我操怎么这么多警察啊？整个内场里几十个警察围着观众席站了一圈，感觉不像个演唱会倒像是要公审什么黑帮团伙似的。</p>
<p>我当时拿出照相机对着警察狂拍了一通，准备发 Facebook 搏眼球。你注意过吗，老外拍的中国照片里特爱出现警察，一个特俗特常见的套路是天安门，前景是一个没表情的武警士兵，背景是天安门城楼上的毛主席像。</p>
<p>总结一下，拍照小技巧：如果你是老外，你拍的街拍照片上出现警察一定加分；如果你是老中，你拍的街拍照片上出现老外一定加分。不管你是老外还是老中，如果街拍照片上出现流浪猫流浪狗再加分。</p>
<p>但是注意，这个套路反过来不行。</p>
<p>如果你是老外，你在中国的街拍照片上出现老外不仅加不了分还会减分——说明你去的地方不够本土不够新奇，全是外国旅游者。如果你是老中，你没事儿不去拍老外净追着警察瞎拍什么啊——没见过警察？装什么外宾啊。</p>
<p>反思一下，那天我在纵贯线演唱会上拍警察就很有装外宾的嫌疑。</p>
<p>所以，怎么看周杰伦在演唱会上骂警察这件事？</p>
<p>道理是一样的——这取决于你认为周杰伦是老外还是老中，是外宾还是内宾。</p>
<p>如果你觉得他是个老外，那在演唱会上看到警察维持秩序觉得新奇、不习惯、甚至愤怒什么的完全可以理解。但如果你觉得他是个老中，这么做就有点大惊小怪，有装逼的嫌疑了。</p>
<p>周杰伦不是特爱说「中文歌才是最屌的」吗？</p>
<p>感觉上他自己还挺爱扮老中的。
　　　　　</p>
<p>如何评价周杰伦？​<br>听我干巴巴地评价周杰伦多没意思，褚老师给你讲一个简单、有效、实用的回答问题的套路吧，这个套路不仅适用于回答对周杰伦如何评价这类问题，还会对你工作、学习、相亲、面试什么的都有用，哎呀太有用了。</p>
<p>二〇〇二年夏天我在北京嘉里中心的一家公司实习，那时候东三环周边还在建设中，财富中心、国贸三期、央视大裤衩之类的地标建筑都没出现，嘉里中心周围是一片工地。</p>
<p>印象深刻的有两件事。</p>
<p>一件是我当年的经理讲的，他说有一天他加班加到很晚决定去楼下街上洗个头放松一下（没错，嘉里中心这样一个现在寸土寸金的地方当年周边还有很多小发廊），他说洗头的服务人员跟他礼貌地寒暄，说：您在附近工作？他说：是啊，我就在嘉里中心上班。然后那个女的很狐疑地说：不对啊，嘉里中心不是已经完工了吗？</p>
<p>这个工种被称为「码农」不是没有道理的。</p>
<p>还有一件，其实也算不上是什么事儿，就是每天上下班经过那些工地在工地围墙上随处可见的一首「诗」，当时我能完整地背下来，现在只记得一句：争做首都文明人，我不随地大小便。</p>
<p>好吧，扯得有点儿远了。</p>
<p>我想说的是有一天我在嘉里中心一楼的大堂里意外地碰上了一个老熟人。这人叫方文嘉，原来在北大附中就认识，比我小一级，后来在波士顿又碰到过，当时她在普林斯顿读计算机方面的博士，她导师跳槽去了哈佛，于是她也就跟着去了波士顿。我本来在伊利诺伊上学，那年夏天正好去波士顿实习，然后我们又都被另一个在哈佛的北大附中的同学胡晓江拉去排话剧，就这么成了熟人。那是一九九九年。</p>
<p>在嘉里中心见到方文嘉之前我已经三年没见过这人了，忽然在北京的同一幢楼里出现绝对是有点吃惊。约了吃午饭。她说她博士毕业之后先是创业了一段，没成，不想干老本行又不知道干什么好于是只好去做咨询，男朋友在国内发展，所以她就跟着回国去了麦肯锡北京办公室——麦肯锡当时也在嘉里中心。</p>
<p>我当时正考虑要不要做咨询，所以问她：</p>
<p>「你后悔了吗？」</p>
<p>她说：</p>
<p>「你问了三个问题：第一个，我转行后没后悔；第二个，我回国后没后悔；第三个，我去麦肯锡后没后悔。」</p>
<p>她回答问题的语气、表情、套路跟三年前比像换了一个人。你瞧，经过麦肯锡这么一家职业忽悠公司锻炼的人感觉就是不一样。</p>
<p>这个套路的第一步就是：</p>
<p>不直接回答原问题。</p>
<p>这一步很关键，被提问者带着走是回答问题的大忌，这样很容易让场面按照别人引导的方向发展甚至落入圈套。不信你可以研究一下牛逼新闻发布会的套路，不管是中国的还是美国的，发言人很少听过问题上来就直接回答，但是好的发言人或者政客也不会子说自话不回答问题，他们会运用套路的第二步：</p>
<p>分解、转化原问题。</p>
<p>这样做的目的不是为了转移话题，而是为了：</p>
<p>（一）把问题清晰化。用自己的解读去重新构造问题，跟听众交代清楚你要回答问题中所隐含的所有条件和假设，避免别人对答案的误读。</p>
<p>（二）把问题结构化，把一个大问题分解成几个小问题，可以让你的思维和答案都更有结构、层次，避免那种想到哪儿说到哪儿「一团意面」类的答案。</p>
<p>（三）把问题立体化，提供对同一个问题几个不同的角度，这样可以增加你思维的空间维度，使得答案变得更有深度。这么做的另一个好处是可以拖时间增加篇幅，别人一句话答案之后就没话说了，而你可以侃侃而谈说上半天。</p>
<p>（四）把让你不舒服的问题变成让你舒服的问题。说白了，就是把你不想回答的问题转化成你想回答的问题，把你不知道答案的问题变成你知道答案的问题。</p>
<p>分解、转化问题好，那么，该分解成几个问题呢？具体情况具体分析？错！这个套路的第三个要点是：</p>
<p>三是神奇的数字。</p>
<p>一个哈佛商学院毕业的朋友说，他们班上有一个同学上课特爱发言，不管什么课什么教授说什么话题什么案例他都得插上几句，而且每次都是用同一个开场白：</p>
<p>Three things come to mind …… 想到三件事 ……</p>
<p>有一回一个教授被弄得有点儿烦了，半开玩笑地说：你原来是麦肯锡的吧？</p>
<p>这人上商学院之前还真是麦肯锡的。</p>
<p>我想说的是啊，三是一个神奇的数字，不管什么问题你永远可以不过脑子地先说有三点，结果往往听起来都挺像那么回事。「想到三件事」是一个不错的套路，更好的是方文嘉用的那个：「你问了三个问题」——听着就很牛逼很唬人。</p>
<p>好，课讲完了，下面是课后练习。</p>
<p>练习一：</p>
<p>你去一家从事手机、高科技的公司面试，面试官问你：</p>
<p>你对苹果什么评价？</p>
<p>你该怎么回答呢？说你对苹果的热爱？说你对乔布斯的崇拜？说你觉得苹果用户体验太差？预测苹果新机的颜色、销量？你要是这么稀里糊涂地开始回答，结果只能是一团糟。套用褚老师刚教你的套路，你可以说：</p>
<p>您问了三个问题：一、我对苹果手机这个产品怎么评价，二、我对苹果公司这家企业怎么评价，三、我对苹果（拥有巨大数目铁粉的）这个现象怎么评价。</p>
<p>怎么样，感觉来了吧？</p>
<p>练习二：</p>
<p>有人问，你对周杰伦什么评价？</p>
<p>套路是一样的，你可以说：</p>
<p>你问了三个问题：一、周杰伦的音乐，二、周杰伦这个人，三、周杰伦流行的这个现象。</p>
<p>褚老师的答案是：一、难听，二、不讨厌，三、中国屌丝多。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/17/2019-10-17-%E8%A6%81%E4%B9%88%E8%A0%A2%E8%A6%81%E4%B9%88%E5%9D%8F%E7%9A%84%E6%80%9D%E7%BB%B4%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/17/2019-10-17-%E8%A6%81%E4%B9%88%E8%A0%A2%E8%A6%81%E4%B9%88%E5%9D%8F%E7%9A%84%E6%80%9D%E7%BB%B4%E6%96%B9%E5%BC%8F/" itemprop="url">要么蠢要么坏的思维方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-17T00:00:00+08:00">
                2019-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>多数人倒也是真的不一味反对市场，只是总有个“但是”。比如上篇文章里的一个读者是这么评论的：</p>
<p>在小地方，供给有限的情况下也确实可能串通涨价，可能一个小镇上只有两三家网吧，七八家理发店，你涨人家也涨，或者你串通一两家涨，其他的也未免不会跟风涨。市场经济的完全自由竞争是好的，但政府相应的监管我觉得也是不可或缺的，只是有时候大家觉得管多了，该管的不管，可是这个度，还真不好拿捏。</p>
<p>这套说辞十分常见，他们也赞同竞争的好处，但同时认为价格监管（至少上篇我们谈的是价格）也是必要的，只不过一个拿捏的问题。首先结论是，价格根本不需要也不应该被干预。在精密的超级计算机都计算不出来什么价格是最优的。这里不仅是动态变化，背后还有人的意志。</p>
<p>另外，很多人喜欢说完全自由竞争，其实也是一句顺口溜。理论上完全自由竞争并不存在，自由的竞争有，只要政府不插手，但完全的竞争，只是一种人脑子里期待的一种无限接近。从不存在完全的竞争，想象下也是存在过一瞬间，但其实是不可描述的状态。</p>
<p>上篇文章是从理发店开始，那我们更极端一点吧，假设一座孤岛上只有一座理发店，这个理发店提供的是一种延年益寿的特殊理发服务，理发养生，独门绝技。没有竞争，连潜在的竞争都没有。这种理发价格应该多少钱呢？正常情况下必然是天价了，人人都想多活几年。</p>
<p>好，那么价格应该多少合适？没有答案不是因为算不出来，而是因为定价权其实是私有财产的一个分支。什么叫定价权，就是我的东西我想卖想扔掉（等于是价格为零）都是我的自由。这是定价权。</p>
<p>如果这个岛上神奇的理发师有一天突然就不想理发了，给多少钱都不，可以吗？实在给不出任何理由。因为人家不欠任何人的。</p>
<p>一个尊重私有产权的社会在制定任何政策的时候都应该小心翼翼避免侵害了他人的财产权。当然，这是我们的期望。因为我相信大部分人都不希望自己的东西被肆意剥夺，在交易的时候价格被各种名义限制，都希望生活在私有财产能得到最大程度保障的社会，那么在思考问题时请尽量从个人权利的角度出发，否则要么是蠢要么就是坏了。</p>
<p>蠢，以为这种侵害不会到自己头上。坏，侵犯别人又不关我的事。</p>
<p>房产税支持，觉得主要是一种度的拿捏，遗产税支持，觉得要均衡好，稳定物价也支持，说这是关乎国计民生，稳定团结。总会找到理由，因为好像跟自己完全无关，贵州的一个县的牛肉粉就应该不让涨价，毕竟卖牛肉粉的不是你嘛。</p>
<p>从权利的角度谈问题很多人都觉得过于简单了，会钻牛角尖，举出各种困境。其实把这些暂且放在一边，只是说，最好需要养成这样的思维习惯，学会从权利的角度先想一遍。这是一个健全社会公民应有的基础思维方式。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/16/2019-10-16-%E9%81%97%E6%86%BE%EF%BC%8C%E8%BF%99%E4%BA%9B%E4%BA%BA%E6%89%8D%E6%98%AF%E5%A4%9A%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/16/2019-10-16-%E9%81%97%E6%86%BE%EF%BC%8C%E8%BF%99%E4%BA%9B%E4%BA%BA%E6%89%8D%E6%98%AF%E5%A4%9A%E6%95%B0/" itemprop="url">遗憾，这些人才是多数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-16T00:00:00+08:00">
                2019-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原创： 吴主任  吴主任  今天</p>
<p>贵州黔西县的牛肉粉因为涨价被当地市场监管部门认定为“串通涨价”事件。价格管制的话题我大概聊了有十年了，算上以前工作时做的专题，数量没法统计。所以那篇文章更想分享的是一大串的评论，想让大家知道，你以为的基础常识在很多人的认知里不是。</p>
<p>今天，中国的绝大多数人一边享受着市场经济带来的繁荣，一边又总是在期待有关部门能够把各种价格关起来，当然主要是那些他们觉得贵的，不合理的。</p>
<p>比如有个读者问：但如果一点都不管的话，商贩涨价完全没成本没约束啊，就像洗发店似的，一个比一个贵，去年还都25剪一个，今年蹭蹭蹭都涨到35。即使明天楼下的理发店都涨到50一次，我也没什么办法不是吗？难道每次要坐车去其它地方剪头发？</p>
<p>那就再一次耐心地就这个问题展开聊一聊。</p>
<p>说说我亲历的理发的价格。2009年，榆林市，50块钱。2019年，北京市，5块钱。请注意时间和地点。有些人确实不知道，北京一些广场或者路边那种理发摊位，就5块钱。当然，你随便去一家有托尼总监的店，一两百块钱不要太惊讶。</p>
<p>总体上几十年来的物价上涨非常明显，这个每个人稍微回忆一下都能体会到。也正因此总会有让你惊讶的价格存在。这也是很多人打开拼多多时的感受，但如果去过小地方的批发市场就明白，拼多多不过是把它们搬到网上去了而已。</p>
<p>这些都是竞争，价格也是动态的。说涨价没有约束完全是胡话。按照人们趋利避害的特性，谁卖东西不想卖个天价呢？这种想也就是痴心妄想，因为最大的约束就是市场。理发店也想理个头一千块钱，你去开个理发店试试，看是不是可以随意涨价。或者随便二手市场随便卖个东西，试试就知道了。</p>
<p>所以我们要感谢竞争，因为竞争是最大的监督和约束。商家们本分做事，笑脸相迎，服务到位绝不是吃饱了没事干，只是为了更有竞争力。只有那种被权力挡在门外的领域才可以高枕无忧，商品和服务态度都很恶劣，还活得不错。靠有关部门监督吗？可以，配合一下做做样子，但无法解决根本问题。</p>
<p>很简单的道理，应付监管容易，讨好消费者却非常难。前者不仅是死的，而且可以收买，后者的要求就苛刻了，而且随时在变化。比如说衣服，某种潮流可能过了一季就彻底无人问津了。</p>
<p>价格管制的必然结果就是打击供给，有利可图才会吸引更多人进来。价格严格管制，不仅打击了供给，也会让原本的商品和服务的质量在消费者注意不到的地方偷工减料。</p>
<p>就理发这么小的一件事，价格也是整个经济运转过程慢慢给出的。如果定高了可能就关店了，定低了呢，有些划不来。至于多少钱合适，没有任何可参考的标准，这跟该商品和服务的目标人群定位和所在地的整体经济情况以及整个大环境的物价等息息相关。因此，即便从这一点也可以看出价格管制有多荒谬。市场监管部门里的那些人凭什么知道某个商品多少钱合适？但他们觉得他们知道。</p>
<p>楼下的理发店突然涨到100块钱了，这件事可能发生吗？几乎不可能，除非就是不想干了。因为理发不是生死攸关，也不是整座城市就这一家。总有替代品。</p>
<p>如果有一天你醒来发现整座城市每家理发店剪个头发最少1000块钱，你确认下是不是穿越到二十年后了，然后出门看看楼下的一碗面条是不是差不多也得500块钱，如果都不是，依然是当下的时间和物价。那么，请相信我，大概率是你根本没心思关心发型问题，你和隔壁老王都在着急筹划快速开个理发店。媒体称这一现象为“莫名其妙的时尚保健风引起的理发店泡沫”“退潮了才知道谁在裸泳”……</p>
<p>常去的理发店突然涨价了你受不了，你当然没办法人家，但你可以选择便宜的，或者自己理发，要求管一管有些无耻，人家并没有欠你什么。除非你觉得有天物价局也来限制你的工资上限是合理的。今年你要求月薪五千，明年你希望找个八千的，凭什么呢？也让物价局管一管你的价格啊。不得高于五千！</p>
<p>如此基础枯燥且无聊的话题，聊着聊着就1600多个字了。但不可思议的是居然那么多人支持有关部门管一管贵州牛肉粉的涨价。但我们要直面现实，中国真的好大，地大物博物种丰富，我们国家8亿网民，估计有6亿是希望有关部门管一管各种商品价格的。所以，非常遗憾，现实就是这些人才是多数。也正因此有关部门如鱼得水。恭喜发财。</p>
<p>言归正传，真心希望能有更多人明白这些基础的知识。别人的观念看似与自己无关，但更深入地看，社会是由每个人的观念共同作用下决定了一个大致的方向。因此，不能说重复这些“基础常识”没用，考虑到当下的局面多数人的认知，更多人能明白些正确的且并不难懂理念，长远当然是有利于每个人。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/11/2019-10-11-Android%20Gradle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/11/2019-10-11-Android%20Gradle/" itemprop="url">Android Gradle</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-11T00:00:00+08:00">
                2019-10-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>gradle是作为一个在Android studio中的编译打包工具。<br>关于grale的编译打包流程可以<a href="https://developer.android.com/studio/build" target="_blank" rel="noopener">看图</a></p>
<h1 id="项目编译配置文件"><a href="#项目编译配置文件" class="headerlink" title="项目编译配置文件"></a>项目编译配置文件</h1><p><a href="https://developer.android.com/studio/build" target="_blank" rel="noopener">看图</a><br>在日常我们创建一个Android项目的时候目录就是这样的。</p>
<h2 id="gradle配置文件"><a href="#gradle配置文件" class="headerlink" title="gradle配置文件"></a>gradle配置文件</h2><p>setting.gradle是当我们的项目中需要引入一些jar，arr等第三方库包含到我们的项目中时我们需要在这个gradle中配置。</p>
<h2 id="项目的gradle-—-build-gradle"><a href="#项目的gradle-—-build-gradle" class="headerlink" title="项目的gradle — build.gradle"></a>项目的gradle — build.gradle</h2><p>此编译文件适用于项目中所有模块的编译配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Top-level build file where you can add configuration options common to all sub-projects&#x2F;modules.</span><br><span class="line"></span><br><span class="line">buildscript &#123;</span><br><span class="line">    </span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &#39;com.android.tools.build:gradle:3.3.1&#39;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; NOTE: Do not place your application dependencies here; they belong</span><br><span class="line">        &#x2F;&#x2F; in the individual module build.gradle files</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        maven &#123; url &#39;https:&#x2F;&#x2F;jitpack.io&#39; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task clean(type: Delete) &#123;</span><br><span class="line">    delete rootProject.buildDir</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的配置代码中buildscript代码块主要是依赖gradle插件。allprojects代码块可以理解为项目中需要依赖的第三方仓库从google和jcenter以及maven { url ‘<a href="https://jitpack.io&#39;" target="_blank" rel="noopener">https://jitpack.io&#39;</a> }拉取。</p>
<h2 id="配置项目属性"><a href="#配置项目属性" class="headerlink" title="配置项目属性"></a>配置项目属性</h2><p>在项目的build.gradle中我们还可以配置在所有模块build.gradle中共用的属性，因此可以在顶级项目build.gradle中ext代码块中配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;...&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;...&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; This block encapsulates custom properties and makes them available to all</span><br><span class="line">&#x2F;&#x2F; modules in the project.</span><br><span class="line">ext &#123;</span><br><span class="line">    &#x2F;&#x2F; The following are only a few examples of the types of properties you can define.</span><br><span class="line">    compileSdkVersion &#x3D; 28</span><br><span class="line">    &#x2F;&#x2F; You can also create properties to specify versions for dependencies.</span><br><span class="line">    &#x2F;&#x2F; Having consistent versions between modules can avoid conflicts with behavior.</span><br><span class="line">    supportLibVersion &#x3D; &quot;28.0.0&quot;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>然后在模块中引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  &#x2F;&#x2F; Use the following syntax to access properties you defined at the project level:</span><br><span class="line">  &#x2F;&#x2F; rootProject.ext.property_name</span><br><span class="line">  compileSdkVersion rootProject.ext.compileSdkVersion</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation &quot;com.android.support:appcompat-v7:$&#123;rootProject.ext.supportLibVersion&#125;&quot;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="应用级编译模块"><a href="#应用级编译模块" class="headerlink" title="应用级编译模块"></a>应用级编译模块</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * The first line in the build configuration applies the Android plugin for</span><br><span class="line"> * Gradle to this build and makes the android block available to specify</span><br><span class="line"> * Android-specific build options.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">apply plugin: &#39;com.android.application&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * The android block is where you configure all your Android-specific</span><br><span class="line"> * build options.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * compileSdkVersion specifies the Android API level Gradle should use to</span><br><span class="line">   * compile your app. This means your app can use the API features included in</span><br><span class="line">   * this API level and lower.</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">  compileSdkVersion 28</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * buildToolsVersion specifies the version of the SDK build tools, command-line</span><br><span class="line">   * utilities, and compiler that Gradle should use to build your app. You need to</span><br><span class="line">   * download the build tools using the SDK Manager.</span><br><span class="line">   *</span><br><span class="line">   * This property is optional because the plugin uses a recommended version of</span><br><span class="line">   * the build tools by default.</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">  buildToolsVersion &quot;29.0.0&quot;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * The defaultConfig block encapsulates default settings and entries for all</span><br><span class="line">   * build variants, and can override some attributes in main&#x2F;AndroidManifest.xml</span><br><span class="line">   * dynamically from the build system. You can configure product flavors to override</span><br><span class="line">   * these values for different versions of your app.</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">  defaultConfig &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * applicationId uniquely identifies the package for publishing.</span><br><span class="line">     * However, your source code should still reference the package name</span><br><span class="line">     * defined by the package attribute in the main&#x2F;AndroidManifest.xml file.</span><br><span class="line">     *&#x2F;</span><br><span class="line"></span><br><span class="line">    applicationId &#39;com.example.myapp&#39;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Defines the minimum API level required to run the app.</span><br><span class="line">    minSdkVersion 15</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Specifies the API level used to test the app.</span><br><span class="line">    targetSdkVersion 28</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Defines the version number of your app.</span><br><span class="line">    versionCode 1</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Defines a user-friendly version name for your app.</span><br><span class="line">    versionName &quot;1.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * The buildTypes block is where you can configure multiple build types.</span><br><span class="line">   * By default, the build system defines two build types: debug and release. The</span><br><span class="line">   * debug build type is not explicitly shown in the default build configuration,</span><br><span class="line">   * but it includes debugging tools and is signed with the debug key. The release</span><br><span class="line">   * build type applies Proguard settings and is not signed by default.</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">  buildTypes &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * By default, Android Studio configures the release build type to enable code</span><br><span class="line">     * shrinking, using minifyEnabled, and specifies the Proguard settings file.</span><br><span class="line">     *&#x2F;</span><br><span class="line"></span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled true &#x2F;&#x2F; Enables code shrinking for the release build type.</span><br><span class="line">        proguardFiles getDefaultProguardFile(&#39;proguard-android.txt&#39;), &#39;proguard-rules.pro&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * The productFlavors block is where you can configure multiple product flavors.</span><br><span class="line">   * This allows you to create different versions of your app that can</span><br><span class="line">   * override the defaultConfig block with their own settings. Product flavors</span><br><span class="line">   * are optional, and the build system does not create them by default.</span><br><span class="line">   *</span><br><span class="line">   * This example creates a free and paid product flavor. Each product flavor</span><br><span class="line">   * then specifies its own application ID, so that they can exist on the Google</span><br><span class="line">   * Play Store, or an Android device, simultaneously.</span><br><span class="line">   *</span><br><span class="line">   * If you declare product flavors, you must also declare flavor dimensions</span><br><span class="line">   * and assign each flavor to a flavor dimension.</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">  flavorDimensions &quot;tier&quot;</span><br><span class="line">  productFlavors &#123;</span><br><span class="line">    free &#123;</span><br><span class="line">      dimension &quot;tier&quot;</span><br><span class="line">      applicationId &#39;com.example.myapp.free&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    paid &#123;</span><br><span class="line">      dimension &quot;tier&quot;</span><br><span class="line">      applicationId &#39;com.example.myapp.paid&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * The splits block is where you can configure different APK builds that</span><br><span class="line">   * each contain only code and resources for a supported screen density or</span><br><span class="line">   * ABI. You&#39;ll also need to configure your build so that each APK has a</span><br><span class="line">   * different versionCode.</span><br><span class="line">   *&#x2F;</span><br><span class="line"></span><br><span class="line">  splits &#123;</span><br><span class="line">    &#x2F;&#x2F; Settings to build multiple APKs based on screen density.</span><br><span class="line">    density &#123;</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; Enable or disable building multiple APKs.</span><br><span class="line">      enable false</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; Exclude these densities when building multiple APKs.</span><br><span class="line">      exclude &quot;ldpi&quot;, &quot;tvdpi&quot;, &quot;xxxhdpi&quot;, &quot;400dpi&quot;, &quot;560dpi&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * The dependencies block in the module-level build configuration file</span><br><span class="line"> * specifies dependencies required to build only the module itself.</span><br><span class="line"> * To learn more, go to Add build dependencies.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation project(&quot;:lib&quot;)</span><br><span class="line">    implementation &#39;com.android.support:appcompat-v7:28.0.0&#39;</span><br><span class="line">    implementation fileTree(dir: &#39;libs&#39;, include: [&#39;*.jar&#39;])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果当前apk需要打多渠道包的话可以通过productFlavors添加不通的渠道。</p>
<h1 id="gradle-properties"><a href="#gradle-properties" class="headerlink" title="gradle.properties"></a>gradle.properties</h1><p>在这个文件中可以设置gradle。<br>#local.properties<br>当前编译环境的sdk和ndk路径，这个文件里的内容由Androidstudio自动完成。</p>
<h2 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h2><ul>
<li>implementation:只会暴露给直接依赖的模块<br>在项目中我们创建2个moudle,分别命名为Module1和Module2.他们的依赖关系为：<br>app(implementation Module1)—&gt;Module1(implementation Moudle2)—&gt;Module2.<br>这种依赖关系中我们无法在app中使用Module2中的资源。</li>
<li>api:会暴露给间接依赖的模块<br>如上此时app可以调用Module2中的资源。</li>
<li>compileOnly:只在编译期间依赖模块,打包以后运行时不会依赖。<br>如上依赖关系为 app(implementation Module1)—&gt;Module1(compileOnly  Module2)—&gt;Module2.<br>在编译期间app无法引用到Module2,Module1中正常引用，但是打包运行之后会报错，从名称也可以看出仅编译时。</li>
<li>runtimeOnly:只在运行时依赖模块,编译时不依赖 </li>
</ul>
<h2 id="productFlavors"><a href="#productFlavors" class="headerlink" title="productFlavors"></a>productFlavors</h2><h2 id="sourceSets"><a href="#sourceSets" class="headerlink" title="sourceSets"></a>sourceSets</h2><h2 id="怎样生成一个Gradle-Wrapper"><a href="#怎样生成一个Gradle-Wrapper" class="headerlink" title="怎样生成一个Gradle Wrapper"></a>怎样生成一个Gradle Wrapper</h2><p>项目中的gradle wrapper目录文件可以帮助我们统一gradle的版本以免造成程序开发中版本不一构建失败的问题。<br>有些时候我们可以在项目中通过命令的方式在我们的项目目录中生成一个wrapper（包装）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$gradle wrapper</span><br></pre></td></tr></table></figure>
<h2 id="gradle-wrapper-properties"><a href="#gradle-wrapper-properties" class="headerlink" title="gradle-wrapper.properties"></a>gradle-wrapper.properties</h2><p> 这个是在项目中的gradle文件中的gradle配置文件,它里面的内容主要有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#Fri Oct 11 22:58:29 CST 2019</span><br><span class="line">distributionBase&#x3D;GRADLE_USER_HOME</span><br><span class="line">distributionPath&#x3D;wrapper&#x2F;dists</span><br><span class="line">zipStoreBase&#x3D;GRADLE_USER_HOME</span><br><span class="line">zipStorePath&#x3D;wrapper&#x2F;dists</span><br><span class="line">distributionUrl&#x3D;https\:&#x2F;&#x2F;services.gradle.org&#x2F;distributions&#x2F;gradle-5.4.1-all.zip</span><br></pre></td></tr></table></figure>

<ul>
<li>distributionBase:这个表示下载后的gradle压缩包解压后存储的主目录</li>
<li>distributionPath:压缩包的路径</li>
<li>zipStoreBase:存放压缩后的zip</li>
<li>zipStorePath:zip压缩包的路径</li>
<li>distributionUrl:gralde的下载地址(这个非常的重要,因为这个会根据URL路径下载对应的gradle版本)</li>
</ul>
<h2 id="自定义Wrapper-Task"><a href="#自定义Wrapper-Task" class="headerlink" title="自定义Wrapper Task"></a>自定义Wrapper Task</h2><p>我们可以在当前根项目中的buidl.gradle脚本文件中创建一个冠以wrapper的task</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;**</span><br><span class="line">     * 通过task设置要下载的gradle的版本</span><br><span class="line">     *&#x2F;</span><br><span class="line">    task wrappers(type: Wrapper) &#123;</span><br><span class="line">    gradleVersion &#x3D; &#39;5.6.2&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时也可以添加一些其他的配置，比如上面的一些字段(distributionBase,distributionPath,distributionUrl)</p>
<h2 id="强制刷新依赖"><a href="#强制刷新依赖" class="headerlink" title="强制刷新依赖"></a>强制刷新依赖</h2><p>有些时候我们从maven库中下载的一些第三方依赖由于缓存的原因导致一直无法更新到最新的版本,这个时候我们可以通过一下的命令强制第三方依赖刷新.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle --refresh-dependencies assemble</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/10/2019-10-10-Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/10/2019-10-10-Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/" itemprop="url">Java反射机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-10T00:00:00+08:00">
                2019-10-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是Java反射机制"><a href="#什么是Java反射机制" class="headerlink" title="什么是Java反射机制"></a>什么是Java反射机制</h1><p>在我们的开发过程中有些时候需要针对一些特定的类需要更改他的内部传参或者方法的调用以达到我们的目的.</p>
<p>#使用反射获取类的基本信息</p>
<h2 id="获取所有变量的信息"><a href="#获取所有变量的信息" class="headerlink" title="获取所有变量的信息"></a>获取所有变量的信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class childClass &#x3D; Child.class;</span><br><span class="line">        &#x2F;&#x2F;fileds方法是获取当前类和继承的父类的所有public变量</span><br><span class="line">        &#x2F;&#x2F;Field[] declaredFields &#x3D; childClass.getFields();</span><br><span class="line">        &#x2F;&#x2F;DeclaredFields是获取当前类的所有方法和成员变量</span><br><span class="line">        Field[] declaredFields &#x3D; childClass.getDeclaredFields();</span><br><span class="line">        for (Field field : declaredFields) &#123;</span><br><span class="line">            System.out.println(field.getType().getName() + &quot; &quot; + field.getName());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取所有方法的信息"><a href="#获取所有方法的信息" class="headerlink" title="获取所有方法的信息"></a>获取所有方法的信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">        * 获取所有方法的信息</span><br><span class="line">        *&#x2F;</span><br><span class="line">       &#x2F;&#x2F;获取当前类和父类的所有public方法</span><br><span class="line">       &#x2F;&#x2F;Method[] method &#x3D; childClass.getMethods();</span><br><span class="line">       &#x2F;&#x2F;获取本类的所有方法(不问访问权限)</span><br><span class="line">       Method[] methods &#x3D; childClass.getDeclaredMethods();</span><br><span class="line">       for (Method method : methods) &#123;</span><br><span class="line">           &#x2F;&#x2F;获取方法的访问权限</span><br><span class="line">           int modifiers &#x3D; method.getModifiers();</span><br><span class="line">           System.out.println(Modifier.toString(modifiers));</span><br><span class="line">           &#x2F;&#x2F;获取并输出方法的返回类型</span><br><span class="line">           Class&lt;?&gt; returnType &#x3D; method.getReturnType();</span><br><span class="line">           System.out.println(returnType.getName() + &quot; &quot; + method.getName() + &quot; &quot;);</span><br><span class="line">           &#x2F;&#x2F;获取并输出所有方法的参数</span><br><span class="line">           Parameter[] parameters &#x3D; method.getParameters();</span><br><span class="line">           for (Parameter parameter : parameters) &#123;</span><br><span class="line">               System.out.println(parameter.getType().getName() + &quot; &quot; + parameter.getName());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>#访问和操作类的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Method declaredMethod &#x3D; null;</span><br><span class="line">       Child child &#x3D; new Child();</span><br><span class="line">       Class&lt;? extends Child&gt; aClass &#x3D; child.getClass();</span><br><span class="line">       try &#123;</span><br><span class="line">           declaredMethod &#x3D; aClass.getDeclaredMethod(&quot;setGender&quot;, String.class);</span><br><span class="line">           &#x2F;&#x2F;这里调用Accessible的意思就是获取私有方法(private)的访问权限</span><br><span class="line">           declaredMethod.setAccessible(true);</span><br><span class="line">           declaredMethod.invoke(child, &quot;man&quot;);</span><br><span class="line">           System.out.println(child.getGender());</span><br><span class="line">       &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; catch (InvocationTargetException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>#访问和操作变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">           Field field &#x3D; childClass.getDeclaredField(&quot;MSG&quot;);</span><br><span class="line">           field.setAccessible(true);</span><br><span class="line">           field.set(childClass, &quot;MSG CHANGE&quot;);</span><br><span class="line">           System.out.println(&quot;MSG AFTER:&quot; + new Child().getMsg());</span><br><span class="line">       &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/28/2019-09-28-Android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/28/2019-09-28-Android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/" itemprop="url">Android事件分发机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-28T00:00:00+08:00">
                2019-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>学习Android的事件分发机制，掌握其原理能够处理复杂的事件分发解决滑动冲突编写一个Demo示例，通过查看Blog了解。<br>通常我们在业务开发中会碰到多个View可以同时响应一个事件的情况,但是事件又只能传递给其中的某一个View这个时候怎样让系统按照你的意愿将此事件分发给指定的View处理就需要有事件分发的基础了.<br>在Android的事件分发中当我们按下屏幕时这个点击事件传递的顺序是这样：<br>Activity—&gt;phoneWindow—&gt;DecorView—&gt;ViewGroup—&gt;……—&gt;View。</p>
<h2 id="Activity中的事件分发机制"><a href="#Activity中的事件分发机制" class="headerlink" title="Activity中的事件分发机制"></a>Activity中的事件分发机制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">   * Called to process touch screen events.  You can override this to</span><br><span class="line">   * intercept all touch screen events before they are dispatched to the</span><br><span class="line">   * window.  Be sure to call this implementation for touch screen events</span><br><span class="line">   * that should be handled normally.</span><br><span class="line">   *</span><br><span class="line">   * @param ev The touch screen event.</span><br><span class="line">   *</span><br><span class="line">   * @return boolean Return true if this event was consumed.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  public boolean dispatchTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">      if (ev.getAction() &#x3D;&#x3D; MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">          onUserInteraction();</span><br><span class="line">      &#125;</span><br><span class="line">      if (getWindow().superDispatchTouchEvent(ev)) &#123;</span><br><span class="line">          return true;</span><br><span class="line">      &#125;</span><br><span class="line">      return onTouchEvent(ev);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>当前事件首先会在Activity中的dispatchTouchEvent接收,按下的Action先是MotionEvent.ACTION_DOWN然后首先会执行 onUserInteraction()这个方法。<br>接下来分析一下onUserInteraction()这个方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * Called whenever a key, touch, or trackball event is dispatched to the</span><br><span class="line">     * activity.  Implement this method if you wish to know that the user has</span><br><span class="line">     * interacted with the device in some way while your activity is running.</span><br><span class="line">     * This callback and &#123;@link #onUserLeaveHint&#125; are intended to help</span><br><span class="line">     * activities manage status bar notifications intelligently; specifically,</span><br><span class="line">     * for helping activities determine the proper time to cancel a notfication.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;All calls to your activity&#39;s &#123;@link #onUserLeaveHint&#125; callback will</span><br><span class="line">     * be accompanied by calls to &#123;@link #onUserInteraction&#125;.  This</span><br><span class="line">     * ensures that your activity will be told of relevant user activity such</span><br><span class="line">     * as pulling down the notification pane and touching an item there.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;Note that this callback will be invoked for the touch down action</span><br><span class="line">     * that begins a touch gesture, but may not be invoked for the touch-moved</span><br><span class="line">     * and touch-up actions that follow.</span><br><span class="line">     *</span><br><span class="line">     * @see #onUserLeaveHint()</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void onUserInteraction() &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>此方法是一个空方法，当此Activity在栈顶时,触屏点击按home，back，menu键都会触发此方法.<br>接下来分析第二个if语句：getWindow().superDispatchTouchEvent(ev)。<br>getWindow是一个Window它是一个抽象类具体实现是phoneWindow。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   public boolean superDispatchTouchEvent(MotionEvent event) &#123;</span><br><span class="line">       return mDecor.superDispatchTouchEvent(event);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这里将会调用DecorView中的superDispatchTouchEvent。然后在superDispatchTouchEvent中接着调用ViewGroup中的dispatchTouchEvent。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public boolean superDispatchTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        return super.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>最终事件就传递到了我们的ViewGroup中.<br>如果此时getWindow().superDispatchTouchEvent(ev)返回的是true该点击事件将停止往下传递，事件传递结束。否则继续往下调用onTouchEvent(ev)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * Called when a touch screen event was not handled by any of the views</span><br><span class="line">     * under it.  This is most useful to process touch events that happen</span><br><span class="line">     * outside of your window bounds, where there is no view to receive it.</span><br><span class="line">     *</span><br><span class="line">     * @param event The touch screen event being processed.</span><br><span class="line">     *</span><br><span class="line">     * @return Return true if you have consumed the event, false if you haven&#39;t.</span><br><span class="line">     * The default implementation always returns false.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        if (mWindow.shouldCloseOnTouch(this, event)) &#123;</span><br><span class="line">            finish();</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>执行到onTouchEven中的mWindow.shouldCloseOnTouch(this, event)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public boolean shouldCloseOnTouch(Context context, MotionEvent event) &#123;</span><br><span class="line">       final boolean isOutside &#x3D;</span><br><span class="line">               event.getAction() &#x3D;&#x3D; MotionEvent.ACTION_DOWN &amp;&amp; isOutOfBounds(context, event)</span><br><span class="line">               || event.getAction() &#x3D;&#x3D; MotionEvent.ACTION_OUTSIDE;</span><br><span class="line">       if (mCloseOnTouchOutside &amp;&amp; peekDecorView() !&#x3D; null &amp;&amp; isOutside) &#123;</span><br><span class="line">           return true;</span><br><span class="line">       &#125;</span><br><span class="line">       return false;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>返回ture说明事件在边界外,消费了该事件；false未消费此事件(默认).<br>最终onTouchEvent返回的是false(在事件的边界范围内时,默认返回false)，Activity的dispatchTouchEvent执行结束.</p>
<h2 id="ViewGroup的事件分发机制"><a href="#ViewGroup的事件分发机制" class="headerlink" title="ViewGroup的事件分发机制"></a>ViewGroup的事件分发机制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;**</span><br><span class="line">  * 源码分析：ViewGroup.dispatchTouchEvent（）</span><br><span class="line">  *&#x2F; </span><br><span class="line">    public boolean dispatchTouchEvent(MotionEvent ev) &#123; </span><br><span class="line"></span><br><span class="line">    ... &#x2F;&#x2F; 仅贴出关键代码</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 重点分析1：ViewGroup每次事件分发时，都需调用onInterceptTouchEvent()询问是否拦截事件</span><br><span class="line">            if (disallowIntercept || !onInterceptTouchEvent(ev)) &#123;  </span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 判断值1：disallowIntercept &#x3D; 是否禁用事件拦截的功能(默认是false)，可通过调用requestDisallowInterceptTouchEvent（）修改</span><br><span class="line">            &#x2F;&#x2F; 判断值2： !onInterceptTouchEvent(ev) &#x3D; 对onInterceptTouchEvent()返回值取反</span><br><span class="line">                    &#x2F;&#x2F; a. 若在onInterceptTouchEvent()中返回false（即不拦截事件），就会让第二个值为true，从而进入到条件判断的内部</span><br><span class="line">                    &#x2F;&#x2F; b. 若在onInterceptTouchEvent()中返回true（即拦截事件），就会让第二个值为false，从而跳出了这个条件判断</span><br><span class="line">                    &#x2F;&#x2F; c. 关于onInterceptTouchEvent() -&gt;&gt;分析1</span><br><span class="line"></span><br><span class="line">                ev.setAction(MotionEvent.ACTION_DOWN);  </span><br><span class="line">                final int scrolledXInt &#x3D; (int) scrolledXFloat;  </span><br><span class="line">                final int scrolledYInt &#x3D; (int) scrolledYFloat;  </span><br><span class="line">                final View[] children &#x3D; mChildren;  </span><br><span class="line">                final int count &#x3D; mChildrenCount;  </span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 重点分析2</span><br><span class="line">            &#x2F;&#x2F; 通过for循环，遍历了当前ViewGroup下的所有子View</span><br><span class="line">            for (int i &#x3D; count - 1; i &gt;&#x3D; 0; i--) &#123;  </span><br><span class="line">                final View child &#x3D; children[i];  </span><br><span class="line">                if ((child.mViewFlags &amp; VISIBILITY_MASK) &#x3D;&#x3D; VISIBLE  </span><br><span class="line">                        || child.getAnimation() !&#x3D; null) &#123;  </span><br><span class="line">                    child.getHitRect(frame);  </span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 判断当前遍历的View是不是正在点击的View，从而找到当前被点击的View</span><br><span class="line">                    &#x2F;&#x2F; 若是，则进入条件判断内部</span><br><span class="line">                    if (frame.contains(scrolledXInt, scrolledYInt)) &#123;  </span><br><span class="line">                        final float xc &#x3D; scrolledXFloat - child.mLeft;  </span><br><span class="line">                        final float yc &#x3D; scrolledYFloat - child.mTop;  </span><br><span class="line">                        ev.setLocation(xc, yc);  </span><br><span class="line">                        child.mPrivateFlags &amp;&#x3D; ~CANCEL_NEXT_UP_EVENT;  </span><br><span class="line"></span><br><span class="line">                        &#x2F;&#x2F; 条件判断的内部调用了该View的dispatchTouchEvent()</span><br><span class="line">                        &#x2F;&#x2F; 即 实现了点击事件从ViewGroup到子View的传递（具体请看下面的View事件分发机制）</span><br><span class="line">                        if (child.dispatchTouchEvent(ev))  &#123; </span><br><span class="line"></span><br><span class="line">                        mMotionTarget &#x3D; child;  </span><br><span class="line">                        return true; </span><br><span class="line">                        &#x2F;&#x2F; 调用子View的dispatchTouchEvent后是有返回值的</span><br><span class="line">                        &#x2F;&#x2F; 若该控件可点击，那么点击时，dispatchTouchEvent的返回值必定是true，因此会导致条件判断成立</span><br><span class="line">                        &#x2F;&#x2F; 于是给ViewGroup的dispatchTouchEvent（）直接返回了true，即直接跳出</span><br><span class="line">                        &#x2F;&#x2F; 即把ViewGroup的点击事件拦截掉</span><br><span class="line"></span><br><span class="line">                                &#125;  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            boolean isUpOrCancel &#x3D; (action &#x3D;&#x3D; MotionEvent.ACTION_UP) ||  </span><br><span class="line">                    (action &#x3D;&#x3D; MotionEvent.ACTION_CANCEL);  </span><br><span class="line">            if (isUpOrCancel) &#123;  </span><br><span class="line">                mGroupFlags &amp;&#x3D; ~FLAG_DISALLOW_INTERCEPT;  </span><br><span class="line">            &#125;  </span><br><span class="line">            final View target &#x3D; mMotionTarget;  </span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 重点分析3</span><br><span class="line">        &#x2F;&#x2F; 若点击的是空白处（即无任何View接收事件） &#x2F; 拦截事件（手动复写onInterceptTouchEvent（），从而让其返回true）</span><br><span class="line">        if (target &#x3D;&#x3D; null) &#123;  </span><br><span class="line">            ev.setLocation(xf, yf);  </span><br><span class="line">            if ((mPrivateFlags &amp; CANCEL_NEXT_UP_EVENT) !&#x3D; 0) &#123;  </span><br><span class="line">                ev.setAction(MotionEvent.ACTION_CANCEL);  </span><br><span class="line">                mPrivateFlags &amp;&#x3D; ~CANCEL_NEXT_UP_EVENT;  </span><br><span class="line">            &#125;  </span><br><span class="line">            </span><br><span class="line">            return super.dispatchTouchEvent(ev);</span><br><span class="line">            &#x2F;&#x2F; 调用ViewGroup父类的dispatchTouchEvent()，即View.dispatchTouchEvent()</span><br><span class="line">            &#x2F;&#x2F; 因此会执行ViewGroup的onTouch() -&gt;&gt; onTouchEvent() -&gt;&gt; performClick（） -&gt;&gt; onClick()，即自己处理该事件，事件不会往下传递（具体请参考View事件的分发机制中的View.dispatchTouchEvent（））</span><br><span class="line">            &#x2F;&#x2F; 此处需与上面区别：子View的dispatchTouchEvent（）</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        ... </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">  * 分析1：ViewGroup.onInterceptTouchEvent()</span><br><span class="line">  * 作用：是否拦截事件</span><br><span class="line">  * 说明：</span><br><span class="line">  *     a. 返回true &#x3D; 拦截，即事件停止往下传递（需手动设置，即复写onInterceptTouchEvent（），从而让其返回true）</span><br><span class="line">  *     b. 返回false &#x3D; 不拦截（默认）</span><br><span class="line">  *&#x2F;</span><br><span class="line">  public boolean onInterceptTouchEvent(MotionEvent ev) &#123;  </span><br><span class="line">    </span><br><span class="line">    return false;</span><br><span class="line"></span><br><span class="line">  &#125; </span><br><span class="line">  &#x2F;&#x2F; 回到调用原处</span><br></pre></td></tr></table></figure>
<p>ViewGroup每次分发事件时都会调用intercepted询问是否需要拦截事件。对intercepted中的值进行取反。<br>如果intercepted=false就会到ViewGroup中的逻辑，进入newTouchTarget == null &amp;&amp; childrenCount != 0循环遍历找到当前被点击的View。如是进入条件判断的内部，然后调用该View的dispatchTouchEvent如果子View处理了点击事件则返回true直接跳出当前逻辑，否则执行super.dispatchTouchEvent(ev)。接着就会执行View中的onTouch—&gt;onTouchEvent—&gt;performClick。因此ViewGroup中的onTouchEvnet就执行自己处理此事件。</p>
<h2 id="View的事件分发机制"><a href="#View的事件分发机制" class="headerlink" title="View的事件分发机制"></a>View的事件分发机制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">  * Pass the touch screen motion event down to the target view, or this</span><br><span class="line">  * view if it is the target.</span><br><span class="line">  *</span><br><span class="line">  * @param event The motion event to be dispatched.</span><br><span class="line">  * @return True if the event was handled by the view, false otherwise.</span><br><span class="line">  *&#x2F;</span><br><span class="line"> public boolean dispatchTouchEvent(MotionEvent event) &#123;</span><br><span class="line">     &#x2F;&#x2F; If the event should be handled by accessibility focus first.</span><br><span class="line">     if (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class="line">         if ((mViewFlags &amp; ENABLED_MASK) &#x3D;&#x3D; ENABLED &amp;&amp; handleScrollBarDragging(event)) &#123;</span><br><span class="line">             result &#x3D; true;</span><br><span class="line">         &#125;</span><br><span class="line">         &#x2F;&#x2F;noinspection SimplifiableIfStatement</span><br><span class="line">         ListenerInfo li &#x3D; mListenerInfo;</span><br><span class="line">         if (li !&#x3D; null &amp;&amp; li.mOnTouchListener !&#x3D; null</span><br><span class="line">                 &amp;&amp; (mViewFlags &amp; ENABLED_MASK) &#x3D;&#x3D; ENABLED</span><br><span class="line">                 &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123;</span><br><span class="line">             result &#x3D; true;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         if (!result &amp;&amp; onTouchEvent(event)) &#123;</span><br><span class="line">             result &#x3D; true;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>当li就是onTouchListener为空时或者onTouchListener.onTouch=false就会执行onTouchEvent方法,否则直接返回true.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Implement this method to handle touch screen motion events.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * If this method is used to detect click actions, it is recommended that</span><br><span class="line"> * the actions be performed by implementing and calling</span><br><span class="line"> * &#123;@link #performClick()&#125;. This will ensure consistent system behavior,</span><br><span class="line"> * including:</span><br><span class="line"> * &lt;ul&gt;</span><br><span class="line"> * &lt;li&gt;obeying click sound preferences</span><br><span class="line"> * &lt;li&gt;dispatching OnClickListener calls</span><br><span class="line"> * &lt;li&gt;handling &#123;@link AccessibilityNodeInfo#ACTION_CLICK ACTION_CLICK&#125; when</span><br><span class="line"> * accessibility features are enabled</span><br><span class="line"> * &lt;&#x2F;ul&gt;</span><br><span class="line"> *</span><br><span class="line"> * @param event The motion event.</span><br><span class="line"> * @return True if the event was handled, false otherwise.</span><br><span class="line"> *&#x2F;</span><br><span class="line">public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">    final float x &#x3D; event.getX();</span><br><span class="line">    final float y &#x3D; event.getY();</span><br><span class="line">    final int viewFlags &#x3D; mViewFlags;</span><br><span class="line">    final int action &#x3D; event.getAction();</span><br><span class="line"></span><br><span class="line">    final boolean clickable &#x3D; ((viewFlags &amp; CLICKABLE) &#x3D;&#x3D; CLICKABLE</span><br><span class="line">            || (viewFlags &amp; LONG_CLICKABLE) &#x3D;&#x3D; LONG_CLICKABLE)</span><br><span class="line">            || (viewFlags &amp; CONTEXT_CLICKABLE) &#x3D;&#x3D; CONTEXT_CLICKABLE;</span><br><span class="line"></span><br><span class="line">    if ((viewFlags &amp; ENABLED_MASK) &#x3D;&#x3D; DISABLED) &#123;</span><br><span class="line">        if (action &#x3D;&#x3D; MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) !&#x3D; 0) &#123;</span><br><span class="line">            setPressed(false);</span><br><span class="line">        &#125;</span><br><span class="line">        mPrivateFlags3 &amp;&#x3D; ~PFLAG3_FINGER_DOWN;</span><br><span class="line">        &#x2F;&#x2F; A disabled view that is clickable still consumes the touch</span><br><span class="line">        &#x2F;&#x2F; events, it just doesn&#39;t respond to them.</span><br><span class="line">        return clickable;</span><br><span class="line">    &#125;</span><br><span class="line">    if (mTouchDelegate !&#x3D; null) &#123;</span><br><span class="line">        if (mTouchDelegate.onTouchEvent(event)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (clickable || (viewFlags &amp; TOOLTIP) &#x3D;&#x3D; TOOLTIP) &#123;</span><br><span class="line">        switch (action) &#123;</span><br><span class="line">            case MotionEvent.ACTION_UP:</span><br><span class="line">                mPrivateFlags3 &amp;&#x3D; ~PFLAG3_FINGER_DOWN;</span><br><span class="line">                if ((viewFlags &amp; TOOLTIP) &#x3D;&#x3D; TOOLTIP) &#123;</span><br><span class="line">                    handleTooltipUp();</span><br><span class="line">                &#125;</span><br><span class="line">                if (!clickable) &#123;</span><br><span class="line">                    removeTapCallback();</span><br><span class="line">                    removeLongPressCallback();</span><br><span class="line">                    mInContextButtonPress &#x3D; false;</span><br><span class="line">                    mHasPerformedLongPress &#x3D; false;</span><br><span class="line">                    mIgnoreNextUpEvent &#x3D; false;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                boolean prepressed &#x3D; (mPrivateFlags &amp; PFLAG_PREPRESSED) !&#x3D; 0;</span><br><span class="line">                if ((mPrivateFlags &amp; PFLAG_PRESSED) !&#x3D; 0 || prepressed) &#123;</span><br><span class="line">                    &#x2F;&#x2F; take focus if we don&#39;t have it already and we should in</span><br><span class="line">                    &#x2F;&#x2F; touch mode.</span><br><span class="line">                    boolean focusTaken &#x3D; false;</span><br><span class="line">                    if (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;</span><br><span class="line">                        focusTaken &#x3D; requestFocus();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (prepressed) &#123;</span><br><span class="line">                        &#x2F;&#x2F; The button is being released before we actually</span><br><span class="line">                        &#x2F;&#x2F; showed it as pressed.  Make it show the pressed</span><br><span class="line">                        &#x2F;&#x2F; state now (before scheduling the click) to ensure</span><br><span class="line">                        &#x2F;&#x2F; the user sees it.</span><br><span class="line">                        setPressed(true, x, y);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123;</span><br><span class="line">                        &#x2F;&#x2F; This is a tap, so remove the longpress check</span><br><span class="line">                        removeLongPressCallback();</span><br><span class="line"></span><br><span class="line">                        &#x2F;&#x2F; Only perform take click actions if we were in the pressed state</span><br><span class="line">                        if (!focusTaken) &#123;</span><br><span class="line">                            &#x2F;&#x2F; Use a Runnable and post this rather than calling</span><br><span class="line">                            &#x2F;&#x2F; performClick directly. This lets other visual state</span><br><span class="line">                            &#x2F;&#x2F; of the view update before click actions start.</span><br><span class="line">                            if (mPerformClick &#x3D;&#x3D; null) &#123;</span><br><span class="line">                                mPerformClick &#x3D; new PerformClick();</span><br><span class="line">                            &#125;</span><br><span class="line">                            if (!post(mPerformClick)) &#123;</span><br><span class="line">                                performClickInternal();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (mUnsetPressedState &#x3D;&#x3D; null) &#123;</span><br><span class="line">                        mUnsetPressedState &#x3D; new UnsetPressedState();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (prepressed) &#123;</span><br><span class="line">                        postDelayed(mUnsetPressedState,</span><br><span class="line">                                ViewConfiguration.getPressedStateDuration());</span><br><span class="line">                    &#125; else if (!post(mUnsetPressedState)) &#123;</span><br><span class="line">                        &#x2F;&#x2F; If the post failed, unpress right now</span><br><span class="line">                        mUnsetPressedState.run();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    removeTapCallback();</span><br><span class="line">                &#125;</span><br><span class="line">                mIgnoreNextUpEvent &#x3D; false;</span><br><span class="line">                break;</span><br><span class="line"></span><br><span class="line">            case MotionEvent.ACTION_DOWN:</span><br><span class="line">                if (event.getSource() &#x3D;&#x3D; InputDevice.SOURCE_TOUCHSCREEN) &#123;</span><br><span class="line">                    mPrivateFlags3 |&#x3D; PFLAG3_FINGER_DOWN;</span><br><span class="line">                &#125;</span><br><span class="line">                mHasPerformedLongPress &#x3D; false;</span><br><span class="line"></span><br><span class="line">                if (!clickable) &#123;</span><br><span class="line">                    checkForLongClick(0, x, y);</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (performButtonActionOnTouchDown(event)) &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F; Walk up the hierarchy to determine if we&#39;re inside a scrolling container.</span><br><span class="line">                boolean isInScrollingContainer &#x3D; isInScrollingContainer();</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F; For views inside a scrolling container, delay the pressed feedback for</span><br><span class="line">                &#x2F;&#x2F; a short period in case this is a scroll.</span><br><span class="line">                if (isInScrollingContainer) &#123;</span><br><span class="line">                    mPrivateFlags |&#x3D; PFLAG_PREPRESSED;</span><br><span class="line">                    if (mPendingCheckForTap &#x3D;&#x3D; null) &#123;</span><br><span class="line">                        mPendingCheckForTap &#x3D; new CheckForTap();</span><br><span class="line">                    &#125;</span><br><span class="line">                    mPendingCheckForTap.x &#x3D; event.getX();</span><br><span class="line">                    mPendingCheckForTap.y &#x3D; event.getY();</span><br><span class="line">                    postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    &#x2F;&#x2F; Not inside a scrolling container, so show the feedback right away</span><br><span class="line">                    setPressed(true, x, y);</span><br><span class="line">                    checkForLongClick(0, x, y);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line"></span><br><span class="line">            case MotionEvent.ACTION_CANCEL:</span><br><span class="line">                if (clickable) &#123;</span><br><span class="line">                    setPressed(false);</span><br><span class="line">                &#125;</span><br><span class="line">                removeTapCallback();</span><br><span class="line">                removeLongPressCallback();</span><br><span class="line">                mInContextButtonPress &#x3D; false;</span><br><span class="line">                mHasPerformedLongPress &#x3D; false;</span><br><span class="line">                mIgnoreNextUpEvent &#x3D; false;</span><br><span class="line">                mPrivateFlags3 &amp;&#x3D; ~PFLAG3_FINGER_DOWN;</span><br><span class="line">                break;</span><br><span class="line"></span><br><span class="line">            case MotionEvent.ACTION_MOVE:</span><br><span class="line">                if (clickable) &#123;</span><br><span class="line">                    drawableHotspotChanged(x, y);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                &#x2F;&#x2F; Be lenient about moving outside of buttons</span><br><span class="line">                if (!pointInView(x, y, mTouchSlop)) &#123;</span><br><span class="line">                    &#x2F;&#x2F; Outside button</span><br><span class="line">                    &#x2F;&#x2F; Remove any future long press&#x2F;tap checks</span><br><span class="line">                    removeTapCallback();</span><br><span class="line">                    removeLongPressCallback();</span><br><span class="line">                    if ((mPrivateFlags &amp; PFLAG_PRESSED) !&#x3D; 0) &#123;</span><br><span class="line">                        setPressed(false);</span><br><span class="line">                    &#125;</span><br><span class="line">                    mPrivateFlags3 &amp;&#x3D; ~PFLAG3_FINGER_DOWN;</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果控件可以点击clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP则进入switch判断如果当前事件的action=MotionEvent.ACTION_UP就会执行performClick。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public boolean performClick() &#123;  </span><br><span class="line">       if (mOnClickListener !&#x3D; null) &#123;  </span><br><span class="line">           playSoundEffect(SoundEffectConstants.CLICK);  </span><br><span class="line">           mOnClickListener.onClick(this);  </span><br><span class="line">           return true;  </span><br><span class="line">           &#x2F;&#x2F; 只要我们通过setOnClickListener（）为控件View注册1个点击事件</span><br><span class="line">           &#x2F;&#x2F; 那么就会给mOnClickListener变量赋值（即不为空）</span><br><span class="line">           &#x2F;&#x2F; 则会往下回调onClick（） &amp; performClick（）返回true</span><br><span class="line">       &#125;  </span><br><span class="line">       return false;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>最终如果控件可点击返回true，否则返回false。</p>
<h2 id="requestDisallowInterceptTouchEvent的用法"><a href="#requestDisallowInterceptTouchEvent的用法" class="headerlink" title="requestDisallowInterceptTouchEvent的用法"></a>requestDisallowInterceptTouchEvent的用法</h2><p>先上代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">   * Called when a child does not want this parent and its ancestors to</span><br><span class="line">   * intercept touch events with</span><br><span class="line">   * &#123;@link ViewGroup#onInterceptTouchEvent(MotionEvent)&#125;.</span><br><span class="line">   *</span><br><span class="line">   * &lt;p&gt;This parent should pass this call onto its parents. This parent must obey</span><br><span class="line">   * this request for the duration of the touch (that is, only clear the flag</span><br><span class="line">   * after this parent has received an up or a cancel.&lt;&#x2F;p&gt;</span><br><span class="line">   * </span><br><span class="line">   * @param disallowIntercept True if the child does not want the parent to</span><br><span class="line">   *            intercept touch events.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  public void requestDisallowInterceptTouchEvent(boolean disallowIntercept);</span><br></pre></td></tr></table></figure>
<p>从上面的英文注释我们知道当requestDisallowInterceptTouchEvent返回true表示子view不想父view拦截事件;当requestDisallowInterceptTouchEvent返回false则表示父view想自己处理当前事件(其实就相当于控制了父view是否会执行自己的onInterceptTouchEvent拦截事件方法).<br>requestDisallowInterceptTouchEvent可以用作处理滑动冲突的内部拦截法的一种方式。</p>
<ul>
<li>在内部拦截法中为什么需要在ACTION_DOWN中设置requestDisallowInterceptTouchEvent(true)?</li>
</ul>
<p>requestDisallowInterceptTouchEvent在ViewGroup中的具体实现:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public void requestDisallowInterceptTouchEvent(boolean disallowIntercept) &#123;</span><br><span class="line"></span><br><span class="line">    if (disallowIntercept &#x3D;&#x3D; ((mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) !&#x3D; 0)) &#123;</span><br><span class="line">        &#x2F;&#x2F; We&#39;re already in this state, assume our ancestors are too</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (disallowIntercept) &#123;</span><br><span class="line">        mGroupFlags |&#x3D; FLAG_DISALLOW_INTERCEPT;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        mGroupFlags &amp;&#x3D; ~FLAG_DISALLOW_INTERCEPT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Pass it up to our parent</span><br><span class="line">    if (mParent !&#x3D; null) &#123;</span><br><span class="line">        mParent.requestDisallowInterceptTouchEvent(disallowIntercept);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当disallowIntercept传入true或者false时都是对mGroupFlags产生影响.当事件发生时最先接收到的是父view中的dispatchTouchEvent。</p>
<figure class="highlight plain"><figcaption><span>Handle an initial down.</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">if (actionMasked &#x3D;&#x3D; MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">    &#x2F;&#x2F; Throw away all previous state when starting a new touch gesture.</span><br><span class="line">    &#x2F;&#x2F; The framework may have dropped the up or cancel event for the previous gesture</span><br><span class="line">    &#x2F;&#x2F; due to an app switch, ANR, or some other state change.</span><br><span class="line">    cancelAndClearTouchTargets(ev);</span><br><span class="line">    resetTouchState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Check for interception.</span><br><span class="line">final boolean intercepted;</span><br><span class="line">if (actionMasked &#x3D;&#x3D; MotionEvent.ACTION_DOWN</span><br><span class="line">        || mFirstTouchTarget !&#x3D; null) &#123;</span><br><span class="line">    final boolean disallowIntercept &#x3D; (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) !&#x3D; 0;</span><br><span class="line">    if (!disallowIntercept) &#123;</span><br><span class="line">        intercepted &#x3D; onInterceptTouchEvent(ev);</span><br><span class="line">        ev.setAction(action); &#x2F;&#x2F; restore action in case it was changed</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        intercepted &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F; There are no touch targets and this action is not an initial down</span><br><span class="line">    &#x2F;&#x2F; so this view group continues to intercept touches.</span><br><span class="line">    intercepted &#x3D; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么这里接收到的第一个事件就是MotionEvent.ACTION_DOWN事件,在这里做了两个判断执行一个是cancelAndClearTouchTargets和resetTouchState,另一个就是actionMasked == MotionEvent.ACTION_DOWN|| mFirstTouchTarget != null。<br>首先看第一个判断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    * Cancels and clears all touch targets.</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private void cancelAndClearTouchTargets(MotionEvent event) &#123;</span><br><span class="line">       if (mFirstTouchTarget !&#x3D; null) &#123;</span><br><span class="line">       ...</span><br><span class="line">       clearTouchTargets();</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">    &#x2F;**</span><br><span class="line">    * Clears all touch targets.</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private void clearTouchTargets() &#123;</span><br><span class="line">       ...</span><br><span class="line">       mFirstTouchTarget &#x3D; null;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这里主要是将mFirstTouchTarget设置为null；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    * Resets all touch state in preparation for a new cycle.</span><br><span class="line">    *&#x2F;</span><br><span class="line">   private void resetTouchState() &#123;</span><br><span class="line">       clearTouchTargets();</span><br><span class="line">       resetCancelNextUpFlag(this);</span><br><span class="line">       mGroupFlags &amp;&#x3D; ~FLAG_DISALLOW_INTERCEPT;</span><br><span class="line">       mNestedScrollAxes &#x3D; SCROLL_AXIS_NONE;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>同时将mGroupFlags &amp;= ~FLAG_DISALLOW_INTERCEPT;中的数值取反重置.这里也就是最重要的为什么我们需要在子view中的ACTION_DOWN中首先设置requestDisallowInterceptTouchEvent(true)的原因.如果我们不设置这句代码当程序执行到第二个ACTION_DOWN时就进入了if判断中:</p>
<figure class="highlight plain"><figcaption><span>(actionMasked </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">        || mFirstTouchTarget !&#x3D; null) &#123;</span><br><span class="line">    final boolean disallowIntercept &#x3D; (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) !&#x3D; 0;</span><br><span class="line">    if (!disallowIntercept) &#123;</span><br><span class="line">        intercepted &#x3D; onInterceptTouchEvent(ev);</span><br><span class="line">        ev.setAction(action); &#x2F;&#x2F; restore action in case it was changed</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        intercepted &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F; There are no touch targets and this action is not an initial down</span><br><span class="line">    &#x2F;&#x2F; so this view group continues to intercept touches.</span><br><span class="line">    intercepted &#x3D; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个时候因为mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT之前被重置了所以disallowIntercept=false这个时候就会执行intercepted = onInterceptTouchEvent(ev)这条方法如果父view拦截了那么后续的ACTION_MOVE和ACTION_UP就都不会被子view接收到。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/05/2019-09-05-Android%20Fragment%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/05/2019-09-05-Android%20Fragment%E5%9F%BA%E7%A1%80/" itemprop="url">Android Fragment基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-05T00:00:00+08:00">
                2019-09-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Android Fragment中文翻译为片段。从字面意思可以知道这个就是应用中的一个UI片段，它有自己的生命周期和创建方式。Fragment的出现最初主要是为了实现在大屏幕上 例如：平板的显示提供更加灵活的支持。<br><strong>Fragment必须要基于Activity出现，它不能单独实现自己所以它的生命周期受宿主Activity的影响,当Activity暂停时Fragment也会暂停，当Activity被销毁时Fragment也会被销毁</strong></p>
<h2 id="创建Fragment"><a href="#创建Fragment" class="headerlink" title="创建Fragment"></a>创建Fragment</h2><p>Fragment的创建可以通过两种方式创建一种是在Activity的xml布局文件中编写xml代码，另外一种方式就是通过代码的方式创建.</p>
<ul>
<li>通过xml布局的方式创建Fragment：<br>1.首先创建Fragment的实现类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class MyFragment extends Fragment &#123;</span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        return inflater.inflate(R.layout.my_fragment, container, false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在onCreateView中调用了inflater的inflate方法里面有三个参数，第一个是当前Fragment的布局文件，第二个是一个viewGroup，这里的ViewGroup就是与它关联的Activity，而第三个参数是一个boolean值，设置的是一个false.它的意思是当前布局不与container关联，因为我们在事务transaction中会调用add方法进行关联,如果这里设置为true那么就会关联两次就会有两个重复的布局抛出异常:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalStateException: The specified child already has a parent. You must call removeView() on the child&#39;s parent first.</span><br></pre></td></tr></table></figure>

<p>2.然后在Activity的xml布局中引用这个MyFragment:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id&#x3D;&quot;@+id&#x2F;add_fragment&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:name&#x3D;&quot;com.example.myapplication.MyFragment&quot;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>然后运行程序，这个Fragment就加载到Activity中了.</p>
<ul>
<li>通过代码的方式添加Fragment:</li>
</ul>
<p>1.首先需要创建一个Fragment的类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class MyFragment extends Fragment &#123;</span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        return inflater.inflate(R.layout.my_fragment, container, false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.然后在Activity中创建一个transaction事务，然后再创建Fragment对象，最后通过add的方式将这个Fragment提交.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">transaction &#x3D; getSupportFragmentManager().beginTransaction();</span><br><span class="line">        if (myFragment &#x3D;&#x3D; null) &#123;</span><br><span class="line">            myFragment &#x3D; new MyFragment();</span><br><span class="line">            transaction.add(R.id.add_fragment, myFragment).commit();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>在transaction中看到需要两个参数，第一个参数就是一个id而这个id就是在Activity的xml布局文件中指定的id，第二个参数就是Fragment对象，这个的意思就是将这个Fragment的对象添加到我们指定的id布局中，最后要commit提交这样一个Fragment才正式被添加到了Activity中.</p>
<h2 id="Fragment与Activity之间的通讯"><a href="#Fragment与Activity之间的通讯" class="headerlink" title="Fragment与Activity之间的通讯"></a>Fragment与Activity之间的通讯</h2><ul>
<li>Activity与Fragment通讯:</li>
</ul>
<p>1.Fragment中有一个onAttach方法：、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onAttach(Context context) &#123;</span><br><span class="line">    super.onAttach(context);</span><br><span class="line">    context &#x3D; (MainActivity) context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里我们可以将context强制转换成MainActivity,然后就可以调用我们在Activiy中定义的方法了.<br>2.通过Bundle方式<br>当我们在Activity创建Fragment对象后可以通过调用Bundle传递数据(Bundle只能put基本数据类型或序列化数据)到Fragment中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (myFragment &#x3D;&#x3D; null) &#123;</span><br><span class="line">           myFragment &#x3D; new MyFragment();</span><br><span class="line">           Bundle bundle &#x3D; new Bundle();</span><br><span class="line">           bundle.putString(&quot;key&quot;,&quot;value&quot;);</span><br><span class="line">           myFragment.setArguments(bundle);</span><br><span class="line">           transaction.add(R.id.add_fragment, myFragment).commit();</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>这样就将一个数据发送给了Fragment.</p>
<ul>
<li>Fragment与Activity通讯：<br>在Fragment中编写一个接口,然后对外提供一个方法。在Activity中调用这个方法实现这个接口.</li>
</ul>
<h2 id="Fragment的生命周期"><a href="#Fragment的生命周期" class="headerlink" title="Fragment的生命周期"></a>Fragment的生命周期</h2><p>1.onAttach:Fragment和Activity关联时会被调用,在这个方法中我们可以获取Activity的引用，通过getArgument方法获取Activity传过来的数据.</p>
<p>2.onCreate:Fragment被创建时调用.</p>
<p>3.onCreateView:创建Fragment的布局</p>
<p>4.onActivityCreated:当Activity完成onCreate时调用</p>
<p>5.onStart：当Fragment可见时调用</p>
<p>6.onResume:当Fragment可见并且可交互时调用</p>
<p>7.onPause:当Fragment可见但不可交互时调用</p>
<p>8.onStop：当Fragment不可见时调用</p>
<p>9.onDestoryView：当Fragment的UI从视图结构中移除时调用</p>
<p>10.onDestory:销毁Fragment时调用</p>
<p>11.onDetach:当Fragment和Activity解除关联时调用</p>
<p>上述方法中除了onCreateView不需要super方法外，其他方法都需要</p>
<h2 id="Fragment回退栈BackStack"><a href="#Fragment回退栈BackStack" class="headerlink" title="Fragment回退栈BackStack"></a>Fragment回退栈BackStack</h2><p>Fragment有自己的回退栈，给一个Fragment添加回退栈则可以掉用：addToBackStack(“”).<br>如果加入了回退栈当用户点击返回按键时会回滚Fragment事务，如果没有加入回退栈按返回键则直接将Activity出栈。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transaction.add(R.id.add_fragment, myFragment).addToBackStack(&quot;myfragment&quot;).commit();</span><br></pre></td></tr></table></figure>
<p>addToBackStack:将Fragment添加到回退栈中.<br>popBackstack:清除栈顶中的Fragment<br>popBackStack(String tag,int i): 如果i=0,回退到该tag所对应的Fragment层;如果i=FragmentManager.POP_BACK_STACK_INCLUSIVE,回退到该tag所对应的Fragment的上一层<br>popBackStackImmediate:立即清除回退栈中栈顶的Fragment.<br>getBackStackEntryCount:获取回退栈中Fragment的个数.<br>getBackStackEntryAt(int index):获取回退栈中该索引值下的Fragment.<br><strong>示例：</strong><br>模拟京东的回退栈效果，当点击了其他的Fragment时按返回键退出到第一个Fragment.<br>##Fragment回退栈出现的问题<br>当我们将Fragment加入到回退栈时,这个时候按返回键进行操作回到第一个Fragment然后继续点击其他的Fragment时这个时候当前的Fragment的view会remove掉,f.mContainer.removeView(f.mView).<br>原因:当我们是以add方式入栈的时候，此时Fragment的状态为RESUMED，则moveToState将不进行操作；当我们以replace方式入栈，Fragment的状态为INITIALIZING，此时在moveToState中又会重新将此Fragment创建一次，重新走一遍创建时的生命周期。</p>
<h2 id="DialogFragment"><a href="#DialogFragment" class="headerlink" title="DialogFragment"></a>DialogFragment</h2><p>DialogFragment是专门用于处理对话框逻辑的功能，它与AlertDialog和Dialog的区别就是当用户旋转屏幕了之后AlertDialog和Dialog会销毁掉同时如果有数据输入的话数据也会销毁，而DialogFragment则不会同时也可以很好的管理其生命周期.<br>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;RelativeLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">    android:background&#x3D;&quot;@color&#x2F;colorPrimary&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width&#x3D;&quot;300dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;300dp&quot;</span><br><span class="line">        android:layout_centerInParent&#x3D;&quot;true&quot;</span><br><span class="line">        android:text&#x3D;&quot;DialogFragment&quot;</span><br><span class="line">        android:textStyle&#x3D;&quot;bold&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class DialogFragment extends android.support.v4.app.DialogFragment &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        return inflater.inflate(R.layout.fragment_dialog_view,container);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onViewCreated(view, savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> @Override</span><br><span class="line">    public void onClick(View v) &#123;</span><br><span class="line">        DialogFragment dialogFragment &#x3D; new DialogFragment();</span><br><span class="line">        dialogFragment.show(getSupportFragmentManager(),&quot;dialog_fragment&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>有些时候我们在设置DialogFragment固定布局的时候不是想要的效果,这个时候可以通过Fragment的onStart方法设置解决这个问题.具体使用方式如下:<br>示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onStart() &#123;</span><br><span class="line">    super.onStart();</span><br><span class="line">    Dialog dialog &#x3D; getDialog();</span><br><span class="line">    if (dialog !&#x3D; null) &#123;</span><br><span class="line">        Window window &#x3D; dialog.getWindow();</span><br><span class="line">        WindowManager.LayoutParams attributes &#x3D; window.getAttributes();</span><br><span class="line">        attributes.width &#x3D; getResources().getDimensionPixelSize(R.dimen.width_400);</span><br><span class="line">        attributes.height &#x3D; getResources().getDimensionPixelSize(R.dimen.height_500);</span><br><span class="line">        window.setAttributes(attributes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##为什么需要在onStart后修改Dialog布局才有效<br>只有dialogFragment执行到onStart之后才会调用mDialog.show()显示弹框，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   public void onStart() &#123;</span><br><span class="line">       super.onStart();</span><br><span class="line">       if (mDialog !&#x3D; null) &#123;</span><br><span class="line">           mViewDestroyed &#x3D; false;</span><br><span class="line">           mDialog.show();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>接下来看一看dialog.show的源码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void show() &#123;</span><br><span class="line">        if (mShowing) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!mCreated) &#123;</span><br><span class="line">            dispatchOnCreate(null);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    mWindowManager.addView(mDecor, l);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码中如果dialog还没有创建就执行dispatchOnCreate(null)方法来创建dialog布局</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> void dispatchOnCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        if (!mCreated) &#123;</span><br><span class="line">            mDialog.setContentView(selectContentView());</span><br><span class="line">            mCreated &#x3D; true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#x2F;&#x2F;获取相应的布局样式</span><br><span class="line">    private int selectContentView() &#123;</span><br><span class="line">        if (mButtonPanelSideLayout &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return mAlertDialogLayout;</span><br><span class="line">        &#125;</span><br><span class="line">        if (mButtonPanelLayoutHint &#x3D;&#x3D; AlertDialog.LAYOUT_HINT_SIDE) &#123;</span><br><span class="line">            recaiturn mButtonPanelSideLayout;</span><br><span class="line">        &#125;</span><br><span class="line">        return mAlertDialogLayout;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在这里mDialog会通过selectContentView获取系统布局然后设置到setContentView中，所以在show之前如果我们自定义了dialog的宽高都是无效的，最后还是会在show中被覆盖成系统自带的格式。<br><strong>所以只有在show后面改变布局的属性才会有效</strong></p>
<h2 id="Fragment懒加载"><a href="#Fragment懒加载" class="headerlink" title="Fragment懒加载"></a>Fragment懒加载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author joshuayingwhat</span><br><span class="line"> *&#x2F;</span><br><span class="line">public abstract class BaseLazyFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    protected boolean isViewCreated;</span><br><span class="line"></span><br><span class="line">    protected boolean isVisibleToUser;</span><br><span class="line"></span><br><span class="line">    protected boolean isDataInited;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onAttach(Context context) &#123;</span><br><span class="line">        super.onAttach(context);</span><br><span class="line">        Log.e(&quot;Tag&quot;, &quot;------onAttach------&quot; + (isViewCreated));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onViewCreated(view, savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onActivityCreated(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onActivityCreated(savedInstanceState);</span><br><span class="line">        isViewCreated &#x3D; true;</span><br><span class="line">        prepareFetchData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void prepareFetchData() &#123;</span><br><span class="line">        prepareFetchData(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @param fetchdata</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void prepareFetchData(boolean fetchdata) &#123;</span><br><span class="line">        &#x2F;&#x2F;每次都加载数据</span><br><span class="line">        if (isVisibleToUser &amp;&amp; isViewCreated &amp;&amp; (!isDataInited || fetchdata)) &#123;</span><br><span class="line">            fetchdata();</span><br><span class="line">            isDataInited &#x3D; true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected abstract void fetchdata();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setUserVisibleHint(boolean isVisibleToUser) &#123;</span><br><span class="line">        super.setUserVisibleHint(isVisibleToUser);</span><br><span class="line">        this.isVisibleToUser &#x3D; isVisibleToUser;</span><br><span class="line">        prepareFetchData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Fragment中<strong>setUserVisibleHint</strong>方法表示是否显示,当Fragment是否显示或者不显示通过isVisibleToUser表示。<br>当Fragment UI被创建时，同时isVisibleToUser Fragment已经显示，这个时候执行加载数据的操作。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/03/2019-01-16-HandlerThread%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E5%92%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/03/2019-01-16-HandlerThread%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E5%92%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/" itemprop="url">HandlerThread简单使用和原理分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-03T00:00:00+08:00">
                2019-09-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="HandlerThread的简单使用"><a href="#HandlerThread的简单使用" class="headerlink" title="HandlerThread的简单使用"></a>HandlerThread的简单使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">stock_data_update &#x3D; new HandlerThread(&quot;stock_data_update&quot;);</span><br><span class="line">    stock_data_update.start();</span><br><span class="line">    stockHandler &#x3D; new Handler(stock_data_update.getLooper()) &#123;</span><br><span class="line">      @Override public void handleMessage(Message msg) &#123;</span><br><span class="line">        super.handleMessage(msg);</span><br><span class="line">        if (msg.what &#x3D;&#x3D; 100) &#123;</span><br><span class="line">          update();</span><br><span class="line">          stockHandler.sendEmptyMessage(100);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">     private void update() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      Thread.sleep(1000);</span><br><span class="line">      mHandler.post(new Runnable() &#123;</span><br><span class="line">        @Override public void run() &#123;</span><br><span class="line">          stockTv.setText(&quot;当前大盘实时数据：&quot; + (Math.random() * 3000 + 1000));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最在任务已经处理完成后要在合适的位置退出掉这个线程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stock_data_update.quit();</span><br></pre></td></tr></table></figure>
<h2 id="HandlerThread的源码"><a href="#HandlerThread的源码" class="headerlink" title="HandlerThread的源码"></a>HandlerThread的源码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Handy class for starting a new thread that has a looper. The looper can then be </span><br><span class="line"> * used to create handler classes. Note that start() must still be called.</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class HandlerThread extends Thread &#123;</span><br><span class="line">    int mPriority;</span><br><span class="line">    int mTid &#x3D; -1;</span><br><span class="line">    Looper mLooper;</span><br><span class="line">    private @Nullable Handler mHandler;</span><br><span class="line"></span><br><span class="line">    public HandlerThread(String name) &#123;</span><br><span class="line">        super(name);</span><br><span class="line">        mPriority &#x3D; Process.THREAD_PRIORITY_DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Constructs a HandlerThread.</span><br><span class="line">     * @param name</span><br><span class="line">     * @param priority The priority to run the thread at. The value supplied must be from </span><br><span class="line">     * &#123;@link android.os.Process&#125; and not from java.lang.Thread.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public HandlerThread(String name, int priority) &#123;</span><br><span class="line">        super(name);</span><br><span class="line">        mPriority &#x3D; priority;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Call back method that can be explicitly overridden if needed to execute some</span><br><span class="line">     * setup before Looper loops.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    protected void onLooperPrepared() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        mTid &#x3D; Process.myTid();</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            mLooper &#x3D; Looper.myLooper();</span><br><span class="line">            notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">        Process.setThreadPriority(mPriority);</span><br><span class="line">        onLooperPrepared();</span><br><span class="line">        Looper.loop();</span><br><span class="line">        mTid &#x3D; -1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;**</span><br><span class="line">     * This method returns the Looper associated with this thread. If this thread not been started</span><br><span class="line">     * or for any reason isAlive() returns false, this method will return null. If this thread</span><br><span class="line">     * has been started, this method will block until the looper has been initialized.  </span><br><span class="line">     * @return The looper.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Looper getLooper() &#123;</span><br><span class="line">        if (!isAlive()) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; If the thread has been started, wait until the looper has been created.</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            while (isAlive() &amp;&amp; mLooper &#x3D;&#x3D; null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mLooper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @return a shared &#123;@link Handler&#125; associated with this thread</span><br><span class="line">     * @hide</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @NonNull</span><br><span class="line">    public Handler getThreadHandler() &#123;</span><br><span class="line">        if (mHandler &#x3D;&#x3D; null) &#123;</span><br><span class="line">            mHandler &#x3D; new Handler(getLooper());</span><br><span class="line">        &#125;</span><br><span class="line">        return mHandler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Quits the handler thread&#39;s looper.</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * Causes the handler thread&#39;s looper to terminate without processing any</span><br><span class="line">     * more messages in the message queue.</span><br><span class="line">     * &lt;&#x2F;p&gt;&lt;p&gt;</span><br><span class="line">     * Any attempt to post messages to the queue after the looper is asked to quit will fail.</span><br><span class="line">     * For example, the &#123;@link Handler#sendMessage(Message)&#125; method will return false.</span><br><span class="line">     * &lt;&#x2F;p&gt;&lt;p class&#x3D;&quot;note&quot;&gt;</span><br><span class="line">     * Using this method may be unsafe because some messages may not be delivered</span><br><span class="line">     * before the looper terminates.  Consider using &#123;@link #quitSafely&#125; instead to ensure</span><br><span class="line">     * that all pending work is completed in an orderly manner.</span><br><span class="line">     * &lt;&#x2F;p&gt;</span><br><span class="line">     *</span><br><span class="line">     * @return True if the looper looper has been asked to quit or false if the</span><br><span class="line">     * thread had not yet started running.</span><br><span class="line">     *</span><br><span class="line">     * @see #quitSafely</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public boolean quit() &#123;</span><br><span class="line">        Looper looper &#x3D; getLooper();</span><br><span class="line">        if (looper !&#x3D; null) &#123;</span><br><span class="line">            looper.quit();</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Quits the handler thread&#39;s looper safely.</span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * Causes the handler thread&#39;s looper to terminate as soon as all remaining messages</span><br><span class="line">     * in the message queue that are already due to be delivered have been handled.</span><br><span class="line">     * Pending delayed messages with due times in the future will not be delivered.</span><br><span class="line">     * &lt;&#x2F;p&gt;&lt;p&gt;</span><br><span class="line">     * Any attempt to post messages to the queue after the looper is asked to quit will fail.</span><br><span class="line">     * For example, the &#123;@link Handler#sendMessage(Message)&#125; method will return false.</span><br><span class="line">     * &lt;&#x2F;p&gt;&lt;p&gt;</span><br><span class="line">     * If the thread has not been started or has finished (that is if</span><br><span class="line">     * &#123;@link #getLooper&#125; returns null), then false is returned.</span><br><span class="line">     * Otherwise the looper is asked to quit and true is returned.</span><br><span class="line">     * &lt;&#x2F;p&gt;</span><br><span class="line">     *</span><br><span class="line">     * @return True if the looper looper has been asked to quit or false if the</span><br><span class="line">     * thread had not yet started running.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public boolean quitSafely() &#123;</span><br><span class="line">        Looper looper &#x3D; getLooper();</span><br><span class="line">        if (looper !&#x3D; null) &#123;</span><br><span class="line">            looper.quitSafely();</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Returns the identifier of this thread. See Process.myTid().</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public int getThreadId() &#123;</span><br><span class="line">        return mTid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从源码看出HandlerThread继承了Thread类,所以它是一个线程只不过它的内部用了handler。创建一个HandlerThread对象后需要调用start方法启动它.然后它的run方法就执行了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void run() &#123;</span><br><span class="line">    mTid &#x3D; Process.myTid();</span><br><span class="line">    Looper.prepare();</span><br><span class="line">    synchronized (this) &#123;</span><br><span class="line">        mLooper &#x3D; Looper.myLooper();</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">    Process.setThreadPriority(mPriority);</span><br><span class="line">    onLooperPrepared();</span><br><span class="line">    Looper.loop();</span><br><span class="line">    mTid &#x3D; -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里通过Looper开启无限循环,同时在onLooperPrepared方法中做一些初始化的工作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">    * Call back method that can be explicitly overridden if needed to execute some</span><br><span class="line">    * setup before Looper loops.</span><br><span class="line">    *&#x2F;</span><br><span class="line">   protected void onLooperPrepared() &#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="John Doe" />
          <p class="site-author-name" itemprop="name">John Doe</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
